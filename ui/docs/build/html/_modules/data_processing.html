

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>data_processing &mdash; SCOOTER 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=e031e9a9"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            SCOOTER
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project_overview.html">Scooter UI Documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Overview:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Module Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Base Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html#web-modules">Web Modules</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SCOOTER</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">data_processing</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for data_processing</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">db_utils</span> <span class="kn">import</span> <span class="n">database_connection</span>
<span class="kn">import</span> <span class="nn">psycopg2</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">mannwhitneyu</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">zscore</span><span class="p">,</span> <span class="n">pearsonr</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">scipy.spatial.distance</span> <span class="kn">import</span> <span class="n">mahalanobis</span>
<span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">inv</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">draw_chart</span>


<div class="viewcode-block" id="get_ratings"><a class="viewcode-back" href="../api.html#data_processing.get_ratings">[docs]</a><span class="k">def</span> <span class="nf">get_ratings</span><span class="p">(</span><span class="n">pid</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">database_connection</span><span class="p">()</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT main_study_answers, real_indices, modified_indices, imc_indices, atc_indices, correct_imc_values </span>
<span class="s2">                          FROM participants WHERE pid = </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">pid</span><span class="p">,))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">data</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">Error</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error while fetching data from PostgreSQL&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
            <span class="c1">#print(&quot;PostgreSQL connection is closed&quot;)</span>

<div class="viewcode-block" id="get_main_study_ratings"><a class="viewcode-back" href="../api.html#data_processing.get_main_study_ratings">[docs]</a><span class="k">def</span> <span class="nf">get_main_study_ratings</span><span class="p">(</span><span class="n">pid</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">get_ratings</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">main_study_answers</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">real_indices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">modified_indices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">imc_indices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">atc_indices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>

        <span class="c1"># Drop all ratings that are either on imc or atc indices</span>
        <span class="n">main_study_answers</span> <span class="o">=</span> <span class="p">[</span><span class="n">main_study_answers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">main_study_answers</span><span class="p">))</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">imc_indices</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">atc_indices</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">main_study_answers</span></div>

<div class="viewcode-block" id="get_colorblind_answers"><a class="viewcode-back" href="../api.html#data_processing.get_colorblind_answers">[docs]</a><span class="k">def</span> <span class="nf">get_colorblind_answers</span><span class="p">(</span><span class="n">pid</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">database_connection</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT colorblind_answers, correct_digits, ishihara_test_cards </span>
<span class="s2">                    FROM participants WHERE pid = </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">pid</span><span class="p">,))</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">data</span></div>
    
<div class="viewcode-block" id="get_comprehension_check_answers"><a class="viewcode-back" href="../api.html#data_processing.get_comprehension_check_answers">[docs]</a><span class="k">def</span> <span class="nf">get_comprehension_check_answers</span><span class="p">(</span><span class="n">pid</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">database_connection</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT comprehension_check_answers, comprehension_check_images, correct_comprehension_check_answers </span>
<span class="s2">                    FROM participants WHERE pid = </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">pid</span><span class="p">,))</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="process_ratings"><a class="viewcode-back" href="../api.html#data_processing.process_ratings">[docs]</a><span class="k">def</span> <span class="nf">process_ratings</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">post_hoc</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">get_ratings</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">main_study_answers</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">real_indices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">modified_indices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">imc_indices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">atc_indices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">correct_imc_values</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>

        <span class="c1">#print(correct_imc_values)</span>
        
        <span class="n">accuracy</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">imc_performance</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">atc_performance</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">imc_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">atc_index</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">wrong_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">wrong_ratings</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">wrong_answers_real</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">wrong_answers_modified</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">main_study_answers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No data found for the given pid&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">main_study_answers</span><span class="p">)):</span>

            <span class="n">current_answer</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">main_study_answers</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">real_indices</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">current_answer</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">accuracy</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">wrong_answers_real</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">wrong_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">wrong_ratings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_answer</span><span class="p">)</span>
            
            <span class="k">elif</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">modified_indices</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">current_answer</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">accuracy</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">wrong_answers_modified</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">wrong_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">wrong_ratings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_answer</span><span class="p">)</span>
            
            <span class="k">elif</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">atc_indices</span><span class="p">:</span> 
                <span class="n">atc_index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">post_hoc</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ATC:&quot;</span><span class="p">,</span> <span class="n">atc_index</span><span class="p">,</span> <span class="s2">&quot;Answer:&quot;</span><span class="p">,</span> <span class="n">current_answer</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">current_answer</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">atc_performance</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="k">elif</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">imc_indices</span> <span class="ow">and</span> <span class="n">correct_imc_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="c1"># Get position of value i in imc_indices</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">imc_indices</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">current_answer</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">correct_imc_values</span><span class="p">[</span><span class="n">pos</span><span class="p">]):</span>
                    <span class="n">imc_performance</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">post_hoc</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;IMC:&quot;</span><span class="p">,</span> <span class="n">imc_index</span><span class="p">,</span> <span class="s2">&quot;Answer:&quot;</span><span class="p">,</span> <span class="n">current_answer</span><span class="p">,</span> <span class="s2">&quot;Correct:&quot;</span><span class="p">,</span> <span class="n">correct_imc_values</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span>
                <span class="n">imc_index</span> <span class="o">+=</span> <span class="mi">1</span>

            
        <span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">main_study_answers</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">imc_indices</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">atc_indices</span><span class="p">))</span>
        <span class="n">accuracy</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">accuracy</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">real_accuracy</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">real_indices</span><span class="p">)</span> <span class="o">-</span> <span class="n">wrong_answers_real</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">real_indices</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">modified_accuracy</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">modified_indices</span><span class="p">)</span> <span class="o">-</span> <span class="n">wrong_answers_modified</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">modified_indices</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">check_accuracy</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">imc_performance</span> <span class="o">+</span> <span class="n">atc_performance</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">imc_indices</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">atc_indices</span><span class="p">)),</span> <span class="mi">2</span><span class="p">)</span>
        
        <span class="n">user_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">pid</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">real_accuracy</span><span class="p">,</span> <span class="n">modified_accuracy</span><span class="p">,</span> <span class="n">check_accuracy</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">post_hoc</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">user_data</span>

        <span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy</span> <span class="o">*</span> <span class="mi">100</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You graded&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">main_study_answers</span><span class="p">),</span> <span class="s2">&quot;out of 106 images.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy on the main&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">main_study_answers</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">imc_indices</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">atc_indices</span><span class="p">)</span> <span class="p">,</span><span class="s2">&quot;images: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">accuracy</span><span class="p">),</span> <span class="s2">&quot;%&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy on real images: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">real_indices</span><span class="p">)</span> <span class="o">-</span> <span class="n">wrong_answers_real</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">real_indices</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="s2">&quot;%&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy on modified images: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">modified_indices</span><span class="p">)</span> <span class="o">-</span> <span class="n">wrong_answers_modified</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">modified_indices</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="s2">&quot;%&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">correct_imc_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;IMC Performance:&quot;</span><span class="p">,</span> <span class="n">imc_performance</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">imc_index</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ATC Performance:&quot;</span><span class="p">,</span> <span class="n">atc_performance</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">atc_index</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wrong_indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Wrongly rated main study images:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wrong_indices</span><span class="p">)):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image&quot;</span><span class="p">,</span> <span class="n">wrong_indices</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s2">&quot;was rated as&quot;</span><span class="p">,</span> <span class="n">wrong_ratings</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        
        <span class="k">return</span> <span class="n">wrong_indices</span><span class="p">,</span> <span class="n">real_indices</span><span class="p">,</span> <span class="n">modified_indices</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No data found for the given pid&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>

<div class="viewcode-block" id="display_image_from_bytes"><a class="viewcode-back" href="../api.html#data_processing.display_image_from_bytes">[docs]</a><span class="k">def</span> <span class="nf">display_image_from_bytes</span><span class="p">(</span><span class="n">image_bytes</span><span class="p">):</span>
    <span class="c1"># Convert bytes data to PIL Image</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">image_bytes</span><span class="p">))</span>

    <span class="c1"># Display the image</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>  <span class="c1"># Hide the axis</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="get_comprehension_check_image"><a class="viewcode-back" href="../api.html#data_processing.get_comprehension_check_image">[docs]</a><span class="k">def</span> <span class="nf">get_comprehension_check_image</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">database_connection</span><span class="p">()</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT * </span>
<span class="s2">                          FROM comprehension_check_images </span>
<span class="s2">                          WHERE id = </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
        
        <span class="n">output</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">row</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">is_modified</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">modification</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">obj_class</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">image_number</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Object class:&quot;</span><span class="p">,</span> <span class="n">obj_class</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">is_modified</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Modification:&quot;</span><span class="p">,</span> <span class="n">modification</span><span class="p">)</span>
            
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This is a real image&quot;</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image number:&quot;</span><span class="p">,</span> <span class="n">image_number</span><span class="p">)</span>
            
            <span class="n">display_image_from_bytes</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">Error</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error while fetching data from PostgreSQL&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PostgreSQL connection is closed&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="get_colorblind_image"><a class="viewcode-back" href="../api.html#data_processing.get_colorblind_image">[docs]</a><span class="k">def</span> <span class="nf">get_colorblind_image</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">database_connection</span><span class="p">()</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT * </span>
<span class="s2">                          FROM ishihara_test_cards </span>
<span class="s2">                          WHERE id = </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
        
        <span class="n">output</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">row</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">color_type</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">digit</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Color Type:&quot;</span><span class="p">,</span> <span class="n">color_type</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Correct Digit:&quot;</span><span class="p">,</span> <span class="n">digit</span><span class="p">)</span>
            
            <span class="n">display_image_from_bytes</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">Error</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error while fetching data from PostgreSQL&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PostgreSQL connection is closed&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="get_wrong_image"><a class="viewcode-back" href="../api.html#data_processing.get_wrong_image">[docs]</a><span class="k">def</span> <span class="nf">get_wrong_image</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">pid</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">database_connection</span><span class="p">()</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT main_study_images, real_indices, modified_indices </span>
<span class="s2">                          FROM participants WHERE pid = </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">pid</span><span class="p">,))</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">img_ids</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">real_indices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">modified_indices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">real_indices</span><span class="p">:</span>
                
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT image </span>
<span class="s2">                                  FROM real_images </span>
<span class="s2">                                  WHERE id = </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">img_ids</span><span class="p">[</span><span class="n">index</span><span class="p">],))</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

                <span class="n">display_image_from_bytes</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">return</span> <span class="kc">None</span>


            <span class="k">elif</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">modified_indices</span><span class="p">:</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT image </span>
<span class="s2">                                  FROM modified_images </span>
<span class="s2">                                  WHERE id = </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">img_ids</span><span class="p">[</span><span class="n">index</span><span class="p">],))</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

                <span class="n">display_image_from_bytes</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">Error</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error while fetching data from PostgreSQL&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PostgreSQL connection is closed&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="site_time_tracking"><a class="viewcode-back" href="../api.html#data_processing.site_time_tracking">[docs]</a><span class="k">def</span> <span class="nf">site_time_tracking</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="s2">&quot;http://scooter.l3s.uni-hannover.de/&quot;</span>
    <span class="n">parameter</span> <span class="o">=</span> <span class="s2">&quot;?PROLIFIC_PID=&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current user:&quot;</span><span class="p">,</span> <span class="n">pid</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">database_connection</span><span class="p">()</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT url, time </span>
<span class="s2">                          FROM site_logs WHERE pid = </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">pid</span><span class="p">,))</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">time_of_arrival</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">time_of_departure</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Get the time spent on the site</span>
            <span class="n">time_spent</span> <span class="o">=</span> <span class="n">time_of_departure</span> <span class="o">-</span> <span class="n">time_of_arrival</span>

            <span class="n">hours</span><span class="p">,</span> <span class="n">remainder</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">time_spent</span><span class="o">.</span><span class="n">seconds</span><span class="p">,</span> <span class="mi">3600</span><span class="p">)</span>
            <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">remainder</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>

            <span class="c1"># Get everything between the domain string and the parameter string</span>
            <span class="n">start_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
            <span class="n">end_index</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time spent on&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">[</span><span class="n">start_index</span><span class="p">:</span><span class="n">end_index</span><span class="p">],</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">hours</span><span class="p">,</span> <span class="s2">&quot;hours&quot;</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="s2">&quot;minutes&quot;</span><span class="p">,</span> <span class="n">seconds</span><span class="p">,</span> <span class="s2">&quot;seconds&quot;</span><span class="p">)</span>

        <span class="n">total_time</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">hours</span><span class="p">,</span> <span class="n">remainder</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">total_time</span><span class="o">.</span><span class="n">seconds</span><span class="p">,</span> <span class="mi">3600</span><span class="p">)</span>
        <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">remainder</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total time spent on the site:&quot;</span><span class="p">,</span> <span class="n">hours</span><span class="p">,</span> <span class="s2">&quot;hours&quot;</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="s2">&quot;minutes&quot;</span><span class="p">,</span> <span class="n">seconds</span><span class="p">,</span> <span class="s2">&quot;seconds&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">Error</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error while fetching data from PostgreSQL&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PostgreSQL connection is closed&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="image_time_tracking"><a class="viewcode-back" href="../api.html#data_processing.image_time_tracking">[docs]</a><span class="k">def</span> <span class="nf">image_time_tracking</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">database_connection</span><span class="p">()</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT index, time </span>
<span class="s2">                          FROM image_logs WHERE pid = </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">pid</span><span class="p">,))</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current user:&quot;</span><span class="p">,</span> <span class="n">pid</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># Important: You need to escape the % character in the like clause!</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT max(time)</span>
<span class="s2">                           FROM site_logs </span>
<span class="s2">                           WHERE pid = </span><span class="si">%s</span>
<span class="s2">                           and url like &#39;</span><span class="si">%%</span><span class="s2">main-study?</span><span class="si">%%</span><span class="s2">&#39;&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">pid</span><span class="p">,))</span>

        <span class="n">max_time</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="c1">#print(max_time)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">time_of_arrival</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">time_of_departure</span> <span class="o">=</span> <span class="n">max_time</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">time_of_departure</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Get the time spent on the site</span>
            <span class="n">time_spent</span> <span class="o">=</span> <span class="n">time_of_departure</span> <span class="o">-</span> <span class="n">time_of_arrival</span>

            <span class="n">hours</span><span class="p">,</span> <span class="n">remainder</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">time_spent</span><span class="o">.</span><span class="n">seconds</span><span class="p">,</span> <span class="mi">3600</span><span class="p">)</span>
            <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">remainder</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time spent on image&quot;</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">hours</span><span class="p">,</span> <span class="s2">&quot;hours&quot;</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="s2">&quot;minutes&quot;</span><span class="p">,</span> <span class="n">seconds</span><span class="p">,</span> <span class="s2">&quot;seconds&quot;</span><span class="p">)</span>
        
        <span class="n">total_time</span> <span class="o">=</span> <span class="n">max_time</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">average_time</span> <span class="o">=</span> <span class="n">total_time</span><span class="o">.</span><span class="n">seconds</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">average_seconds</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">average_time</span><span class="p">)</span>
        <span class="n">average_ms</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">average_time</span> <span class="o">-</span> <span class="n">average_seconds</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average time spent on each image:&quot;</span><span class="p">,</span> <span class="n">average_seconds</span><span class="p">,</span> <span class="s2">&quot;seconds&quot;</span><span class="p">,</span> <span class="n">average_ms</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">Error</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error while fetching data from PostgreSQL&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PostgreSQL connection is closed&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="get_leaderboard_pids"><a class="viewcode-back" href="../api.html#data_processing.get_leaderboard_pids">[docs]</a><span class="k">def</span> <span class="nf">get_leaderboard_pids</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">database_connection</span><span class="p">()</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT id </span>
<span class="s2">                          FROM leaderboard&quot;&quot;&quot;</span><span class="p">)</span>
        
        <span class="n">pids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">Error</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error while fetching data from PostgreSQL&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PostgreSQL connection is closed&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pids</span></div>

<div class="viewcode-block" id="get_main_study_image_ids"><a class="viewcode-back" href="../api.html#data_processing.get_main_study_image_ids">[docs]</a><span class="k">def</span> <span class="nf">get_main_study_image_ids</span><span class="p">(</span><span class="n">pid</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">database_connection</span><span class="p">()</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT main_study_images </span>
<span class="s2">                          FROM participants WHERE pid = </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">pid</span><span class="p">,))</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">Error</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error while fetching data from PostgreSQL&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PostgreSQL connection is closed&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="get_ratings_per_image"><a class="viewcode-back" href="../api.html#data_processing.get_ratings_per_image">[docs]</a><span class="k">def</span> <span class="nf">get_ratings_per_image</span><span class="p">(</span><span class="n">pids</span><span class="p">):</span>
    <span class="n">real_images_ratings</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">modified_images_ratings</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">attention_check_ratings</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">imc_ratings</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">database_connection</span><span class="p">()</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

        <span class="c1"># Get all real image ids</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT id </span>
<span class="s2">                          FROM real_images&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">real_image_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="c1"># Initialize dictionary with image ids as keys and empty lists as values</span>
        <span class="k">for</span> <span class="n">image_id</span> <span class="ow">in</span> <span class="n">real_image_ids</span><span class="p">:</span>
            <span class="n">real_images_ratings</span><span class="p">[</span><span class="n">image_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Get all modified image ids</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT id </span>
<span class="s2">                          FROM modified_images&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">modified_image_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="c1"># Initialize dictionary with image ids as keys and empty lists as values</span>
        <span class="k">for</span> <span class="n">image_id</span> <span class="ow">in</span> <span class="n">modified_image_ids</span><span class="p">:</span>
            <span class="n">modified_images_ratings</span><span class="p">[</span><span class="n">image_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Get all attention check image ids</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT id </span>
<span class="s2">                          FROM attention_check_images</span>
<span class="s2">                          WHERE is_imc = False&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">attention_check_image_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="c1"># Initialize dictionary with image ids as keys and empty lists as values</span>
        <span class="k">for</span> <span class="n">image_id</span> <span class="ow">in</span> <span class="n">attention_check_image_ids</span><span class="p">:</span>
            <span class="n">attention_check_ratings</span><span class="p">[</span><span class="n">image_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Get all imc image ids</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT id</span>
<span class="s2">                        FROM attention_check_images</span>
<span class="s2">                        WHERE is_imc = True&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">imc_image_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="c1"># Initialize dictionary with image ids as keys and empty lists as values</span>
        <span class="k">for</span> <span class="n">image_id</span> <span class="ow">in</span> <span class="n">imc_image_ids</span><span class="p">:</span>
            <span class="n">imc_ratings</span><span class="p">[</span><span class="n">image_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">pids</span><span class="p">:</span>
            <span class="n">pid</span> <span class="o">=</span> <span class="n">pid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">get_ratings</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
            <span class="n">main_study_image_ids</span> <span class="o">=</span> <span class="n">get_main_study_image_ids</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">main_study_answers</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">real_indices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">modified_indices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">imc_indices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">atc_indices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">main_study_answers</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">real_indices</span><span class="p">:</span>
                        <span class="n">real_images_ratings</span><span class="p">[</span><span class="n">main_study_image_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pid</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">main_study_answers</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
                    <span class="k">elif</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">modified_indices</span><span class="p">:</span>
                        <span class="n">modified_images_ratings</span><span class="p">[</span><span class="n">main_study_image_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pid</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">main_study_answers</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
                    <span class="k">elif</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">atc_indices</span><span class="p">:</span>
                        <span class="n">attention_check_ratings</span><span class="p">[</span><span class="n">main_study_image_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pid</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">main_study_answers</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
                    <span class="k">elif</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">imc_indices</span><span class="p">:</span>
                        <span class="c1"># check if key exists -- if not: add it + empty list</span>
                        <span class="k">if</span> <span class="n">main_study_image_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">imc_ratings</span><span class="p">:</span>
                            <span class="n">imc_ratings</span><span class="p">[</span><span class="n">main_study_image_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

                        <span class="n">imc_ratings</span><span class="p">[</span><span class="n">main_study_image_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pid</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">main_study_answers</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: Image index not found in any category&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No data found for the given pid&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
        
        <span class="c1">#write_ratings_to_file(real_images_ratings, modified_images_ratings, attention_check_ratings, imc_ratings, pids)</span>
        <span class="n">add_to_ratings_table</span><span class="p">(</span><span class="n">real_images_ratings</span><span class="p">,</span> <span class="n">modified_images_ratings</span><span class="p">,</span> <span class="n">attention_check_ratings</span><span class="p">,</span> <span class="n">imc_ratings</span><span class="p">,</span> <span class="n">pids</span><span class="p">)</span>

    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">Error</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error while fetching data from PostgreSQL&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
            <span class="c1">#print(&quot;PostgreSQL connection is closed&quot;)</span>

<div class="viewcode-block" id="add_to_ratings_table"><a class="viewcode-back" href="../api.html#data_processing.add_to_ratings_table">[docs]</a><span class="k">def</span> <span class="nf">add_to_ratings_table</span><span class="p">(</span><span class="n">real_images_ratings</span><span class="p">,</span> <span class="n">modified_images_ratings</span><span class="p">,</span> <span class="n">attention_check_ratings</span><span class="p">,</span> <span class="n">imc_ratings</span><span class="p">,</span> <span class="n">pids</span><span class="p">):</span>
    <span class="c1"># Create a table to store all the ratings</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">database_connection</span><span class="p">()</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">image_id</span><span class="p">,</span> <span class="n">ratings</span> <span class="ow">in</span> <span class="n">real_images_ratings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rating</span> <span class="ow">in</span> <span class="n">ratings</span><span class="p">:</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;INSERT INTO ratings (image_id, category, pid, rating) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">image_id</span><span class="p">,</span> <span class="s2">&quot;Real Image&quot;</span><span class="p">,</span> <span class="n">rating</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rating</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        
        <span class="k">for</span> <span class="n">image_id</span><span class="p">,</span> <span class="n">ratings</span> <span class="ow">in</span> <span class="n">modified_images_ratings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rating</span> <span class="ow">in</span> <span class="n">ratings</span><span class="p">:</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;INSERT INTO ratings (image_id, category, pid, rating) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">image_id</span><span class="p">,</span> <span class="s2">&quot;Modified Image&quot;</span><span class="p">,</span> <span class="n">rating</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rating</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        
        <span class="k">for</span> <span class="n">image_id</span><span class="p">,</span> <span class="n">ratings</span> <span class="ow">in</span> <span class="n">attention_check_ratings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rating</span> <span class="ow">in</span> <span class="n">ratings</span><span class="p">:</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;INSERT INTO ratings (image_id, category, pid, rating) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">image_id</span><span class="p">,</span> <span class="s2">&quot;ATC&quot;</span><span class="p">,</span> <span class="n">rating</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rating</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        
        <span class="k">for</span> <span class="n">image_id</span><span class="p">,</span> <span class="n">ratings</span> <span class="ow">in</span> <span class="n">imc_ratings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rating</span> <span class="ow">in</span> <span class="n">ratings</span><span class="p">:</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;INSERT INTO ratings (image_id, category, pid, rating) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">image_id</span><span class="p">,</span> <span class="s2">&quot;IMC&quot;</span><span class="p">,</span> <span class="n">rating</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rating</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data inserted successfully in PostgreSQL &quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">Error</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error while fetching data from PostgreSQL&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
            <span class="c1">#print(&quot;PostgreSQL connection is closed&quot;)</span>

<div class="viewcode-block" id="write_ratings_to_file"><a class="viewcode-back" href="../api.html#data_processing.write_ratings_to_file">[docs]</a><span class="k">def</span> <span class="nf">write_ratings_to_file</span><span class="p">(</span><span class="n">real_images_ratings</span><span class="p">,</span> <span class="n">modified_images_ratings</span><span class="p">,</span> <span class="n">attention_check_ratings</span><span class="p">,</span> <span class="n">imc_ratings</span><span class="p">,</span> <span class="n">pids</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;ratings.csv&quot;</span><span class="p">):</span>
    <span class="c1"># Create a csv file to store all the ratings</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Image ID, Category, PID, Rating</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">image_id</span><span class="p">,</span> <span class="n">ratings</span> <span class="ow">in</span> <span class="n">real_images_ratings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rating</span> <span class="ow">in</span> <span class="n">ratings</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">image_id</span><span class="si">}</span><span class="s2">, Real Image, </span><span class="si">{</span><span class="n">rating</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">rating</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">image_id</span><span class="p">,</span> <span class="n">ratings</span> <span class="ow">in</span> <span class="n">modified_images_ratings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rating</span> <span class="ow">in</span> <span class="n">ratings</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">image_id</span><span class="si">}</span><span class="s2">, Modified Image, </span><span class="si">{</span><span class="n">rating</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">rating</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">image_id</span><span class="p">,</span> <span class="n">ratings</span> <span class="ow">in</span> <span class="n">attention_check_ratings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rating</span> <span class="ow">in</span> <span class="n">ratings</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">image_id</span><span class="si">}</span><span class="s2">, ATC, </span><span class="si">{</span><span class="n">rating</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">rating</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">image_id</span><span class="p">,</span> <span class="n">ratings</span> <span class="ow">in</span> <span class="n">imc_ratings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rating</span> <span class="ow">in</span> <span class="n">ratings</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">image_id</span><span class="si">}</span><span class="s2">, IMC, </span><span class="si">{</span><span class="n">rating</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">rating</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="get_sample_averages"><a class="viewcode-back" href="../api.html#data_processing.get_sample_averages">[docs]</a><span class="k">def</span> <span class="nf">get_sample_averages</span><span class="p">(</span><span class="n">pids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_arrays</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">real_images_ratings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">modified_images_ratings</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">pids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="n">database_connection</span><span class="p">()</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT id </span>
<span class="s2">                            FROM leaderboard&quot;&quot;&quot;</span><span class="p">)</span>
            
            <span class="n">pids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">pids</span><span class="p">)</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">Error</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error while fetching data from PostgreSQL&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">connection</span><span class="p">:</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="c1">#print(&quot;PostgreSQL connection is closed&quot;)</span>

    <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">pids</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">get_ratings</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">main_study_answers</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">real_indices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">modified_indices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">main_study_answers</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">real_indices</span><span class="p">:</span>
                    <span class="n">real_images_ratings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">main_study_answers</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="k">elif</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">modified_indices</span><span class="p">:</span>
                    <span class="n">modified_images_ratings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">main_study_answers</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    
    <span class="k">if</span> <span class="n">only_arrays</span><span class="p">:</span>
        <span class="c1">#ratings = np.concatenate((real_images_ratings, modified_images_ratings))</span>
        <span class="c1">#group_real = [0] * len(real_images_ratings)</span>
        <span class="c1">#group_modified = [1] * len(modified_images_ratings)</span>
        <span class="c1">#grouping = np.concatenate((group_real, group_modified))</span>
        <span class="k">return</span> <span class="n">real_images_ratings</span><span class="p">,</span> <span class="n">modified_images_ratings</span>

    <span class="n">real_images_ratings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">real_images_ratings</span><span class="p">)</span>
    <span class="n">real_images_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">real_images_ratings</span><span class="p">)</span>
    <span class="n">real_images_sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">real_images_ratings</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">modified_images_ratings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">modified_images_ratings</span><span class="p">)</span>
    <span class="n">modified_images_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">modified_images_ratings</span><span class="p">)</span>
    <span class="n">modified_images_sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">modified_images_ratings</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">real_images_mean</span><span class="p">,</span> <span class="n">real_images_sd</span><span class="p">,</span> <span class="n">modified_images_mean</span><span class="p">,</span> <span class="n">modified_images_sd</span></div>
    
<div class="viewcode-block" id="get_total_time"><a class="viewcode-back" href="../api.html#data_processing.get_total_time">[docs]</a><span class="k">def</span> <span class="nf">get_total_time</span><span class="p">(</span><span class="n">pid</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">database_connection</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT max(time) - min(time) from site_logs WHERE pid = </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">pid</span><span class="p">,))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="get_average_image_time"><a class="viewcode-back" href="../api.html#data_processing.get_average_image_time">[docs]</a><span class="k">def</span> <span class="nf">get_average_image_time</span><span class="p">(</span><span class="n">pid</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">database_connection</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT (max(time) - min(time)) / 106 from image_logs WHERE pid = </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">pid</span><span class="p">,))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="population_std"><a class="viewcode-back" href="../api.html#data_processing.population_std">[docs]</a><span class="k">def</span> <span class="nf">population_std</span><span class="p">(</span><span class="n">times_array</span><span class="p">,</span> <span class="n">sample_mean</span><span class="p">):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">times_array</span><span class="p">)</span>
    <span class="n">mean_in_seconds</span> <span class="o">=</span> <span class="n">sample_mean</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">times_array</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        <span class="nb">sum</span> <span class="o">+=</span> <span class="p">(</span><span class="n">time</span> <span class="o">-</span> <span class="n">mean_in_seconds</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">sum_in_seconds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">sum_in_seconds</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_time_stats"><a class="viewcode-back" href="../api.html#data_processing.get_time_stats">[docs]</a><span class="k">def</span> <span class="nf">get_time_stats</span><span class="p">(</span><span class="n">pids</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">percentiles</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">total_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">average_image_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">pids</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">get_total_time</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">3600</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User with PID&quot;</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="s2">&quot;was excluded due to being a clear outlier:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">total_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_total_time</span><span class="p">(</span><span class="n">pid</span><span class="p">))</span>
            <span class="n">average_image_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_average_image_time</span><span class="p">(</span><span class="n">pid</span><span class="p">))</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total amount of users:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">total_times</span><span class="p">))</span>

    <span class="n">mean_total_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">total_times</span><span class="p">)</span>
    <span class="n">median_total_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">total_times</span><span class="p">)</span>
    <span class="n">min_total_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">total_times</span><span class="p">)</span>
    <span class="n">max_total_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">total_times</span><span class="p">)</span>
    <span class="n">sd_total_time</span> <span class="o">=</span> <span class="n">population_std</span><span class="p">(</span><span class="n">total_times</span><span class="p">,</span> <span class="n">mean_total_time</span><span class="p">)</span>

    <span class="n">mean_average_image_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">average_image_times</span><span class="p">)</span>
    <span class="n">median_average_image_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">average_image_times</span><span class="p">)</span>
    <span class="n">min_average_image_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">average_image_times</span><span class="p">)</span>
    <span class="n">max_average_image_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">average_image_times</span><span class="p">)</span>
    <span class="n">sd_average_image_time</span> <span class="o">=</span> <span class="n">population_std</span><span class="p">(</span><span class="n">average_image_times</span><span class="p">,</span> <span class="n">mean_average_image_time</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total Time Stats&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total Time Mean:&quot;</span><span class="p">,</span> <span class="n">mean_total_time</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total Time Median:&quot;</span><span class="p">,</span> <span class="n">median_total_time</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total Time Min:&quot;</span><span class="p">,</span> <span class="n">min_total_time</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total Time Max:&quot;</span><span class="p">,</span> <span class="n">max_total_time</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total Time SD:&quot;</span><span class="p">,</span> <span class="n">sd_total_time</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average Image Time Stats&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average Image Time Mean:&quot;</span><span class="p">,</span> <span class="n">mean_average_image_time</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average Image Time Median:&quot;</span><span class="p">,</span> <span class="n">median_average_image_time</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average Image Time Min:&quot;</span><span class="p">,</span> <span class="n">min_average_image_time</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average Image Time Max:&quot;</span><span class="p">,</span> <span class="n">max_average_image_time</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average Image Time SD:&quot;</span><span class="p">,</span> <span class="n">sd_average_image_time</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">percentiles</span><span class="p">:</span>
        <span class="c1"># Get 10th, 5th and 1st percentiles of total time on site and time per image</span>
        <span class="n">total_time_10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">total_times</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">total_time_5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">total_times</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">total_time_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">total_times</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">average_image_time_10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">average_image_times</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">average_image_time_5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">average_image_times</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">average_image_time_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">average_image_times</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total Time 10th Percentile:&quot;</span><span class="p">,</span> <span class="n">total_time_10</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total Time 5th Percentile:&quot;</span><span class="p">,</span> <span class="n">total_time_5</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total Time 1st Percentile:&quot;</span><span class="p">,</span> <span class="n">total_time_1</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average Image Time 10th Percentile:&quot;</span><span class="p">,</span> <span class="n">average_image_time_10</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average Image Time 5th Percentile:&quot;</span><span class="p">,</span> <span class="n">average_image_time_5</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average Image Time 1st Percentile:&quot;</span><span class="p">,</span> <span class="n">average_image_time_1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mean_total_time</span><span class="p">,</span> <span class="n">median_total_time</span><span class="p">,</span> <span class="n">min_total_time</span><span class="p">,</span> <span class="n">max_total_time</span><span class="p">,</span> <span class="n">sd_total_time</span><span class="p">,</span> <span class="n">mean_average_image_time</span><span class="p">,</span> <span class="n">median_average_image_time</span><span class="p">,</span> <span class="n">min_average_image_time</span><span class="p">,</span> <span class="n">max_average_image_time</span><span class="p">,</span> <span class="n">sd_average_image_time</span></div>

<span class="c1"># Conservative Mann-Whitney-U sample size estimation as described in:</span>
<span class="c1"># Section 3 of &quot;Sample Size Determination for Some Common Nonparametric Tests&quot; (Noether, 1987)</span>
<span class="c1"># Code based on R implementation from https://rdrr.io/cran/rankFD/src/R/samplesize.R</span>

<div class="viewcode-block" id="noether"><a class="viewcode-back" href="../api.html#data_processing.noether">[docs]</a><span class="k">def</span> <span class="nf">noether</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="c1"># Input validation</span>
    <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">alpha</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;alpha must be between 0 and 1&quot;</span>
    <span class="k">assert</span> <span class="n">power</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;power must be greater than 0&quot;</span>
    <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;t must be between 0 and 1&quot;</span>
    <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;p must be between 0 and 1&quot;</span>

    <span class="c1"># Calculate Nu based on the simplified assumptions</span>
    <span class="n">Nu</span> <span class="o">=</span> <span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">power</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">n1u</span> <span class="o">=</span> <span class="n">Nu</span> <span class="o">*</span> <span class="n">t</span>
    <span class="n">n2u</span> <span class="o">=</span> <span class="n">Nu</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span>
    
    <span class="c1"># Output the results</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">alpha</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">Nu</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">n1u</span><span class="p">,</span> <span class="n">n2u</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n1u</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n2u</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n1u</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n2u</span><span class="p">)])</span>
    <span class="n">output_matrix</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="n">row_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;alpha (2-sided)&quot;</span><span class="p">,</span> <span class="s2">&quot;Power&quot;</span><span class="p">,</span> <span class="s2">&quot;relevant relative effect p&quot;</span><span class="p">,</span> <span class="s2">&quot;N (total sample size needed)&quot;</span><span class="p">,</span> <span class="s2">&quot;t=n1/N&quot;</span><span class="p">,</span> 
                 <span class="s2">&quot;n1 in Group 1&quot;</span><span class="p">,</span> <span class="s2">&quot;n2 in Group 2&quot;</span><span class="p">,</span> <span class="s2">&quot;N rounded&quot;</span><span class="p">,</span> <span class="s2">&quot;n1 rounded&quot;</span><span class="p">,</span> <span class="s2">&quot;n2 rounded&quot;</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">output_matrix</span><span class="p">,</span> <span class="n">row_names</span></div>

<div class="viewcode-block" id="are_method"><a class="viewcode-back" href="../api.html#data_processing.are_method">[docs]</a><span class="k">def</span> <span class="nf">are_method</span><span class="p">(</span><span class="n">mean_1</span><span class="p">,</span> <span class="n">mean_2</span><span class="p">,</span> <span class="n">std_1</span><span class="p">,</span> <span class="n">std_2</span><span class="p">):</span>
    <span class="n">std_prime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">std_1</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">std_2</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">effect_size</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mean_1</span> <span class="o">-</span> <span class="n">mean_2</span><span class="p">)</span> <span class="o">/</span> <span class="n">std_prime</span>
    <span class="k">return</span> <span class="n">effect_size</span></div>


<div class="viewcode-block" id="subsampling"><a class="viewcode-back" href="../api.html#data_processing.subsampling">[docs]</a><span class="k">def</span> <span class="nf">subsampling</span><span class="p">(</span><span class="n">pids</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">,</span> <span class="n">number_of_sets</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="c1"># The binomial coefficient of C(75, 60) is too high for practical assessments</span>
    <span class="c1"># Therefore, we will use a subsampling method to reduce the number of possible combinations</span>
    <span class="c1"># We will take a sample of 60 images from the 75 available images</span>
    <span class="c1"># We will repeat this process &#39;number_of_sets&#39; times</span>

    <span class="c1"># Create a list to store the subsampled data</span>
    <span class="n">subsampled_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Set the seed for reproducibility</span>
    <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_sets</span><span class="p">):</span>
        <span class="c1"># Randomly select 60 indices from the list of indices</span>
        <span class="n">subsample</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">pids</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Append the selected indices to the subsampled data</span>
        <span class="n">subsampled_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subsample</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">subsampled_data</span></div>

<div class="viewcode-block" id="long_string"><a class="viewcode-back" href="../api.html#data_processing.long_string">[docs]</a><span class="k">def</span> <span class="nf">long_string</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">sequences</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">sequences</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sequences</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">current_val</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">current_count</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ratings</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">ratings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_val</span><span class="p">:</span>
            <span class="n">current_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current_count</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sequences</span><span class="p">:</span>
                <span class="n">sequences</span><span class="p">[</span><span class="n">current_count</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sequences</span><span class="p">[</span><span class="n">current_count</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="n">current_val</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">current_count</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="n">seq_lengths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">sequences</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">seq_lengths</span> <span class="o">+=</span> <span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">*</span> <span class="n">sequences</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    
    <span class="k">return</span> <span class="n">sequences</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">seq_lengths</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">seq_lengths</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">seq_lengths</span><span class="p">)</span></div>

<div class="viewcode-block" id="accumulate_ls_stats"><a class="viewcode-back" href="../api.html#data_processing.accumulate_ls_stats">[docs]</a><span class="k">def</span> <span class="nf">accumulate_ls_stats</span><span class="p">(</span><span class="n">pids</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">previous_means</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">sequences</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">max_seq_length</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">pids</span><span class="p">:</span>
        <span class="n">ratings</span> <span class="o">=</span> <span class="n">get_main_study_ratings</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
        <span class="n">sequences</span><span class="p">,</span> <span class="n">current_max</span><span class="p">,</span> <span class="n">mean_seq_length</span><span class="p">,</span> <span class="n">median_seq_length</span> <span class="o">=</span> <span class="n">long_string</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">sequences</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">current_max</span> <span class="o">&gt;</span> <span class="n">max_seq_length</span><span class="p">:</span>
            <span class="n">max_seq_length</span> <span class="o">=</span> <span class="n">current_max</span>
    
    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="n">draw_chart</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">mean_seq_length</span><span class="p">,</span> <span class="n">median_seq_length</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">previous_means</span><span class="o">=</span><span class="n">previous_means</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sequences:&quot;</span><span class="p">,</span> <span class="n">sequences</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Max Sequence Length:&quot;</span><span class="p">,</span> <span class="n">max_seq_length</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean Sequence Length:&quot;</span><span class="p">,</span> <span class="n">mean_seq_length</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Median Sequence Length:&quot;</span><span class="p">,</span> <span class="n">median_seq_length</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">sequences</span><span class="p">,</span> <span class="n">max_seq_length</span><span class="p">,</span> <span class="n">mean_seq_length</span><span class="p">,</span> <span class="n">median_seq_length</span></div>

<div class="viewcode-block" id="ls_percentiles"><a class="viewcode-back" href="../api.html#data_processing.ls_percentiles">[docs]</a><span class="k">def</span> <span class="nf">ls_percentiles</span><span class="p">(</span><span class="n">pids</span><span class="p">):</span>
    <span class="n">max_seq_lengths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mean_seq_lengths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">median_seq_lengths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">pids</span><span class="p">:</span>
        <span class="n">ratings</span> <span class="o">=</span> <span class="n">get_main_study_ratings</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">max_seq</span><span class="p">,</span> <span class="n">mean_seq</span><span class="p">,</span> <span class="n">median_seq</span> <span class="o">=</span> <span class="n">long_string</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span>
        <span class="n">max_seq_lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_seq</span><span class="p">)</span>
        <span class="n">mean_seq_lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_seq</span><span class="p">)</span>
        <span class="n">median_seq_lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">median_seq</span><span class="p">)</span>
    
    <span class="n">np_max_seq_lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">max_seq_lengths</span><span class="p">)</span>
    <span class="n">np_mean_seq_lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_seq_lengths</span><span class="p">)</span>
    <span class="n">np_median_seq_lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">median_seq_lengths</span><span class="p">)</span>

    <span class="c1"># Get the different percentiles of the max sequence lengths</span>
    <span class="n">max_seq_25</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">np_max_seq_lengths</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
    <span class="n">max_seq_50</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">np_max_seq_lengths</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">max_seq_75</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">np_max_seq_lengths</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
    <span class="c1"># Get the different percentiles of the mean sequence lengths</span>
    <span class="n">mean_seq_25</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">np_mean_seq_lengths</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
    <span class="n">mean_seq_50</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">np_mean_seq_lengths</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">mean_seq_75</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">np_mean_seq_lengths</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
    <span class="c1"># Get the different percentiles of the median sequence lengths</span>
    <span class="n">median_seq_25</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">np_median_seq_lengths</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
    <span class="n">median_seq_50</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">np_median_seq_lengths</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">median_seq_75</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">np_median_seq_lengths</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>

    <span class="c1"># Get minimum, maximum and median of the max sequence lengths</span>
    <span class="n">max_seq_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np_max_seq_lengths</span><span class="p">)</span>
    <span class="n">max_seq_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np_max_seq_lengths</span><span class="p">)</span>
    <span class="n">max_seq_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np_max_seq_lengths</span><span class="p">)</span>
    <span class="c1"># Get minimum, maximum and median of the mean sequence lengths</span>
    <span class="n">mean_seq_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np_mean_seq_lengths</span><span class="p">)</span>
    <span class="n">mean_seq_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np_mean_seq_lengths</span><span class="p">)</span>
    <span class="n">mean_seq_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np_mean_seq_lengths</span><span class="p">)</span>
    <span class="c1"># Get minimum, maximum and median of the median sequence lengths</span>
    <span class="n">median_seq_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np_median_seq_lengths</span><span class="p">)</span>
    <span class="n">median_seq_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np_median_seq_lengths</span><span class="p">)</span>
    <span class="n">median_seq_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np_median_seq_lengths</span><span class="p">)</span>

    <span class="c1"># Get the ranges that cover 85%, 90%, 95% and 99% of the data</span>
    <span class="n">max_seq_85</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">np_max_seq_lengths</span><span class="p">,</span> <span class="mi">85</span><span class="p">)</span>
    <span class="n">max_seq_90</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">np_max_seq_lengths</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">max_seq_95</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">np_max_seq_lengths</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
    <span class="n">max_seq_99</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">np_max_seq_lengths</span><span class="p">,</span> <span class="mi">99</span><span class="p">)</span>
    <span class="n">mean_seq_85</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">np_mean_seq_lengths</span><span class="p">,</span> <span class="mi">85</span><span class="p">)</span>
    <span class="n">mean_seq_90</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">np_mean_seq_lengths</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">mean_seq_95</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">np_mean_seq_lengths</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
    <span class="n">mean_seq_99</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">np_mean_seq_lengths</span><span class="p">,</span> <span class="mi">99</span><span class="p">)</span>
    <span class="n">median_seq_85</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">np_median_seq_lengths</span><span class="p">,</span> <span class="mi">85</span><span class="p">)</span>
    <span class="n">median_seq_90</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">np_median_seq_lengths</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">median_seq_95</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">np_median_seq_lengths</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
    <span class="n">median_seq_99</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">np_median_seq_lengths</span><span class="p">,</span> <span class="mi">99</span><span class="p">)</span>

    <span class="c1"># Print the results</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Max Sequence Lengths&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;25th Percentile:&quot;</span><span class="p">,</span> <span class="n">max_seq_25</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;50th Percentile:&quot;</span><span class="p">,</span> <span class="n">max_seq_50</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;75th Percentile:&quot;</span><span class="p">,</span> <span class="n">max_seq_75</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Min:&quot;</span><span class="p">,</span> <span class="n">max_seq_min</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Max:&quot;</span><span class="p">,</span> <span class="n">max_seq_max</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Median:&quot;</span><span class="p">,</span> <span class="n">max_seq_median</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;85th Percentile:&quot;</span><span class="p">,</span> <span class="n">max_seq_85</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;90th Percentile:&quot;</span><span class="p">,</span> <span class="n">max_seq_90</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;95th Percentile:&quot;</span><span class="p">,</span> <span class="n">max_seq_95</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;99th Percentile:&quot;</span><span class="p">,</span> <span class="n">max_seq_99</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean Sequence Lengths&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;25th Percentile:&quot;</span><span class="p">,</span> <span class="n">mean_seq_25</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;50th Percentile:&quot;</span><span class="p">,</span> <span class="n">mean_seq_50</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;75th Percentile:&quot;</span><span class="p">,</span> <span class="n">mean_seq_75</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Min:&quot;</span><span class="p">,</span> <span class="n">mean_seq_min</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Max:&quot;</span><span class="p">,</span> <span class="n">mean_seq_max</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Median:&quot;</span><span class="p">,</span> <span class="n">mean_seq_median</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;85th Percentile:&quot;</span><span class="p">,</span> <span class="n">mean_seq_85</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;90th Percentile:&quot;</span><span class="p">,</span> <span class="n">mean_seq_90</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;95th Percentile:&quot;</span><span class="p">,</span> <span class="n">mean_seq_95</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;99th Percentile:&quot;</span><span class="p">,</span> <span class="n">mean_seq_99</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Median Sequence Lengths&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;25th Percentile:&quot;</span><span class="p">,</span> <span class="n">median_seq_25</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;50th Percentile:&quot;</span><span class="p">,</span> <span class="n">median_seq_50</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;75th Percentile:&quot;</span><span class="p">,</span> <span class="n">median_seq_75</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Min:&quot;</span><span class="p">,</span> <span class="n">median_seq_min</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Max:&quot;</span><span class="p">,</span> <span class="n">median_seq_max</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Median:&quot;</span><span class="p">,</span> <span class="n">median_seq_median</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;85th Percentile:&quot;</span><span class="p">,</span> <span class="n">median_seq_85</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;90th Percentile:&quot;</span><span class="p">,</span> <span class="n">median_seq_90</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;95th Percentile:&quot;</span><span class="p">,</span> <span class="n">median_seq_95</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;99th Percentile:&quot;</span><span class="p">,</span> <span class="n">median_seq_99</span><span class="p">)</span></div>

<div class="viewcode-block" id="export_study_data_numba"><a class="viewcode-back" href="../api.html#data_processing.export_study_data_numba">[docs]</a><span class="k">def</span> <span class="nf">export_study_data_numba</span><span class="p">(</span><span class="n">pids</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="n">order_ratings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">real_ratings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">modified_ratings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">total_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">average_image_times</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">pids</span><span class="p">:</span>
        
        <span class="n">order_ratings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_main_study_ratings</span><span class="p">(</span><span class="n">pid</span><span class="p">))</span>
        <span class="n">r_pid</span><span class="p">,</span> <span class="n">m_pid</span> <span class="o">=</span> <span class="n">get_sample_averages</span><span class="p">([</span><span class="n">pid</span><span class="p">],</span> <span class="n">only_arrays</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">real_ratings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_pid</span><span class="p">)</span>
        <span class="n">modified_ratings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m_pid</span><span class="p">)</span>

        <span class="n">total_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_total_time</span><span class="p">(</span><span class="n">pid</span><span class="p">))</span>
        <span class="n">average_image_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_average_image_time</span><span class="p">(</span><span class="n">pid</span><span class="p">))</span>

    <span class="c1"># Turn all involved arrays - including pids - into numpy arrays</span>
    <span class="n">pids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pids</span><span class="p">)</span>
    <span class="n">order_ratings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">order_ratings</span><span class="p">)</span>
    <span class="n">real_ratings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">real_ratings</span><span class="p">)</span>
    <span class="n">modified_ratings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">modified_ratings</span><span class="p">)</span>
    <span class="n">total_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">total_times</span><span class="p">)</span>
    <span class="n">average_image_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">average_image_times</span><span class="p">)</span>

    <span class="n">now</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">now</span><span class="si">}</span><span class="s2">_exported_data.npz&quot;</span>

    <span class="c1"># Save the data to disk</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">pids</span><span class="o">=</span><span class="n">pids</span><span class="p">,</span> <span class="n">order_ratings</span><span class="o">=</span><span class="n">order_ratings</span><span class="p">,</span> <span class="n">real_ratings</span><span class="o">=</span><span class="n">real_ratings</span><span class="p">,</span> <span class="n">modified_ratings</span><span class="o">=</span><span class="n">modified_ratings</span><span class="p">,</span> <span class="n">total_times</span><span class="o">=</span><span class="n">total_times</span><span class="p">,</span> <span class="n">average_image_times</span><span class="o">=</span><span class="n">average_image_times</span><span class="p">)</span></div>

<div class="viewcode-block" id="study_overview"><a class="viewcode-back" href="../api.html#data_processing.study_overview">[docs]</a><span class="k">def</span> <span class="nf">study_overview</span><span class="p">(</span><span class="n">pids</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">,</span> <span class="n">number_of_sets</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">checkpoint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">early_stop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">previous_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">subsamples</span> <span class="o">=</span> <span class="n">subsampling</span><span class="p">(</span><span class="n">pids</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">,</span> <span class="n">number_of_sets</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
    <span class="n">header</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;Real Images Mean&quot;</span><span class="p">,</span> <span class="s2">&quot;Real Images SD&quot;</span><span class="p">,</span> <span class="s2">&quot;Modified Images Mean&quot;</span><span class="p">,</span> <span class="s2">&quot;Modified Images SD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;P(X &gt; Y)&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;P-Value&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;Effect Size (PCC)&quot;</span><span class="p">,</span> <span class="s2">&quot;Effect Size (A.R.E)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Required Sample Size (Noether)&quot;</span><span class="p">,</span> <span class="s2">&quot;Required Sample Size (A.R.E.)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Total Time Mean&quot;</span><span class="p">,</span> <span class="s2">&quot;Total Time Median&quot;</span><span class="p">,</span> <span class="s2">&quot;Total Time Min&quot;</span><span class="p">,</span> <span class="s2">&quot;Total Time Max&quot;</span><span class="p">,</span> <span class="s2">&quot;Total Time SD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Average Image Time Mean&quot;</span><span class="p">,</span> <span class="s2">&quot;Average Image Time Median&quot;</span><span class="p">,</span> <span class="s2">&quot;Average Image Time Min&quot;</span><span class="p">,</span> <span class="s2">&quot;Average Image Time Max&quot;</span><span class="p">,</span> <span class="s2">&quot;Average Image Time SD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Max Sequence Length&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean Sequence Length&quot;</span><span class="p">,</span> <span class="s2">&quot;Median Sequence Length&quot;</span>
    <span class="p">]</span>


    <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">checkpoint</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">checkpoint</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">number_of_sets</span> <span class="k">if</span> <span class="n">early_stop</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">early_stop</span>
    <span class="n">subsamples</span> <span class="o">=</span> <span class="n">subsamples</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">now</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">now</span><span class="si">}</span><span class="s2">_overview.csv&quot;</span> <span class="k">if</span> <span class="n">previous_file</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">previous_file</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span> <span class="k">if</span> <span class="n">previous_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;w&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">previous_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">subsample</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">subsamples</span><span class="p">):</span>
                <span class="n">entries</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">subsample</span><span class="p">)</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_sample_averages</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">only_arrays</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="n">real_images_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">real_images_sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                <span class="n">modified_images_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">modified_images_sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                <span class="n">U1</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                <span class="n">p_x_greater_y</span> <span class="o">=</span> <span class="n">U1</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
                <span class="n">U2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">U1</span>
                <span class="n">U</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">U1</span><span class="p">,</span> <span class="n">U2</span><span class="p">)</span>
                <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">U</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span>
                <span class="n">effect_size</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
                <span class="n">effect_size_are</span> <span class="o">=</span> <span class="n">are_method</span><span class="p">(</span><span class="n">real_images_mean</span><span class="p">,</span> <span class="n">modified_images_mean</span><span class="p">,</span> <span class="n">real_images_sd</span><span class="p">,</span> <span class="n">modified_images_sd</span><span class="p">)</span>

                <span class="n">result</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">noether</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p_x_greater_y</span><span class="p">)</span>

                <span class="n">sample_size_are</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">sequences</span><span class="p">,</span> <span class="n">max_seq_length</span><span class="p">,</span> <span class="n">mean_seq_length</span><span class="p">,</span> <span class="n">median_seq_length</span> <span class="o">=</span> <span class="n">accumulate_ls_stats</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>

                <span class="n">total_time_mean</span><span class="p">,</span> <span class="n">total_time_median</span><span class="p">,</span> <span class="n">total_time_min</span><span class="p">,</span> <span class="n">total_time_max</span><span class="p">,</span> <span class="n">total_time_sd</span><span class="p">,</span> <span class="n">average_image_time_mean</span><span class="p">,</span> <span class="n">average_image_time_median</span><span class="p">,</span> <span class="n">average_image_time_min</span><span class="p">,</span> <span class="n">average_image_time_max</span><span class="p">,</span> <span class="n">average_image_time_sd</span> <span class="o">=</span> <span class="n">get_time_stats</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>

                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">real_images_mean</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">real_images_sd</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">modified_images_mean</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">modified_images_sd</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">p_x_greater_y</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">U</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">effect_size</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">effect_size_are</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">sample_size_are</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">total_time_mean</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">total_time_median</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">total_time_min</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">total_time_max</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">total_time_sd</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">average_image_time_mean</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">average_image_time_median</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">average_image_time_min</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">average_image_time_max</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">average_image_time_sd</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">max_seq_length</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">mean_seq_length</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">median_seq_length</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">elif</span> <span class="n">verbose</span><span class="p">:</span>
        
        <span class="k">for</span> <span class="n">subsample</span> <span class="ow">in</span> <span class="n">subsamples</span><span class="p">:</span>
            <span class="n">entries</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">subsample</span><span class="p">)</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_sample_averages</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">only_arrays</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">real_images_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">real_images_sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">modified_images_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">modified_images_sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Real Images Mean:&quot;</span><span class="p">,</span> <span class="n">real_images_mean</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Real Images SD:&quot;</span><span class="p">,</span> <span class="n">real_images_sd</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Modified Images Mean:&quot;</span><span class="p">,</span> <span class="n">modified_images_mean</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Modified Images SD:&quot;</span><span class="p">,</span> <span class="n">modified_images_sd</span><span class="p">)</span>

            <span class="n">U1</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">p_x_greater_y</span> <span class="o">=</span> <span class="n">U1</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
            <span class="n">U2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">U1</span>
            <span class="n">U</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">U1</span><span class="p">,</span> <span class="n">U2</span><span class="p">)</span>
            <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">U</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span>
            <span class="n">effect_size</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
            <span class="n">effect_size_are</span> <span class="o">=</span> <span class="n">are_method</span><span class="p">(</span><span class="n">real_images_mean</span><span class="p">,</span> <span class="n">modified_images_mean</span><span class="p">,</span> <span class="n">real_images_sd</span><span class="p">,</span> <span class="n">modified_images_sd</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;P(X &gt; Y):&quot;</span><span class="p">,</span> <span class="n">p_x_greater_y</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;U:&quot;</span><span class="p">,</span> <span class="n">U</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;P-Value:&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Z:&quot;</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
            <span class="c1"># effect size = z / sqrt(N)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Effect Size:&quot;</span><span class="p">,</span> <span class="n">effect_size</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Effect Size (A.R.E.):&quot;</span><span class="p">,</span> <span class="n">effect_size_are</span><span class="p">)</span>

            <span class="n">result</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">noether</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p_x_greater_y</span><span class="p">)</span>
            <span class="n">sample_size_are</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">sequences</span><span class="p">,</span> <span class="n">max_seq_length</span><span class="p">,</span> <span class="n">mean_seq_length</span><span class="p">,</span> <span class="n">median_seq_length</span> <span class="o">=</span> <span class="n">accumulate_ls_stats</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
            

        
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required sample size for each group (Noether): </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required sample size for each group (A.R.E.): </span><span class="si">{</span><span class="n">sample_size_are</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">get_time_stats</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Long String Stats&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sequences:&quot;</span><span class="p">,</span> <span class="n">sequences</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Max Sequence Length:&quot;</span><span class="p">,</span> <span class="n">max_seq_length</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean Sequence Length:&quot;</span><span class="p">,</span> <span class="n">mean_seq_length</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Median Sequence Length:&quot;</span><span class="p">,</span> <span class="n">median_seq_length</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="population_overview"><a class="viewcode-back" href="../api.html#data_processing.population_overview">[docs]</a><span class="k">def</span> <span class="nf">population_overview</span><span class="p">(</span><span class="n">pids</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_sample_averages</span><span class="p">(</span><span class="n">pids</span><span class="p">,</span> <span class="n">only_arrays</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">real_images_ratings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">real_images_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">real_images_sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">modified_images_ratings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">modified_images_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">modified_images_sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Real Images Mean:&quot;</span><span class="p">,</span> <span class="n">real_images_mean</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Real Images SD:&quot;</span><span class="p">,</span> <span class="n">real_images_sd</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Modified Images Mean:&quot;</span><span class="p">,</span> <span class="n">modified_images_mean</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Modified Images SD:&quot;</span><span class="p">,</span> <span class="n">modified_images_sd</span><span class="p">)</span>

    <span class="n">U1</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">p_x_greater_y</span> <span class="o">=</span> <span class="n">U1</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
    <span class="n">U2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">U1</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;P(X &gt; Y):&quot;</span><span class="p">,</span> <span class="n">p_x_greater_y</span><span class="p">)</span>
    <span class="n">U</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">U1</span><span class="p">,</span> <span class="n">U2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;U:&quot;</span><span class="p">,</span> <span class="n">U</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;P-Value:&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">U</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Z:&quot;</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>

    <span class="n">effect_size</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
    <span class="c1"># effect size = z / sqrt(N)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Effect Size:&quot;</span><span class="p">,</span> <span class="n">effect_size</span><span class="p">)</span>

    <span class="n">result</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">noether</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p_x_greater_y</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required sample size for each group: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">get_time_stats</span><span class="p">(</span><span class="n">pids</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">sequences</span><span class="p">,</span> <span class="n">max_seq_length</span><span class="p">,</span> <span class="n">mean_seq_length</span><span class="p">,</span> <span class="n">median_seq_length</span> <span class="o">=</span> <span class="n">accumulate_ls_stats</span><span class="p">(</span><span class="n">pids</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Long String Stats&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sequences:&quot;</span><span class="p">,</span> <span class="n">sequences</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Max Sequence Length:&quot;</span><span class="p">,</span> <span class="n">max_seq_length</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean Sequence Length:&quot;</span><span class="p">,</span> <span class="n">mean_seq_length</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Median Sequence Length:&quot;</span><span class="p">,</span> <span class="n">median_seq_length</span><span class="p">)</span></div>

<div class="viewcode-block" id="get_booleans"><a class="viewcode-back" href="../api.html#data_processing.get_booleans">[docs]</a><span class="k">def</span> <span class="nf">get_booleans</span><span class="p">(</span><span class="n">pid</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">database_connection</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT attempted_colorblindness, passed_colorblindness, </span>
<span class="s2">                    attempted_comprehension, passed_comprehension, completed_study</span>
<span class="s2">                    FROM participants WHERE pid = </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">pid</span><span class="p">,))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="get_returned_tasks"><a class="viewcode-back" href="../api.html#data_processing.get_returned_tasks">[docs]</a><span class="k">def</span> <span class="nf">get_returned_tasks</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pids_array</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="c1"># Create a dataframe based on the file</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">pids_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df_approved</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;APPROVED&#39;</span><span class="p">]</span>
        <span class="n">pseudo_approved</span> <span class="o">=</span> <span class="n">df_approved</span><span class="p">[</span><span class="o">~</span><span class="n">df_approved</span><span class="p">[</span><span class="s1">&#39;Participant id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">pids_array</span><span class="p">)]</span>
        <span class="n">pseudo_pids</span> <span class="o">=</span> <span class="n">pseudo_approved</span><span class="p">[</span><span class="s2">&quot;Participant id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pseudo PIDs:&quot;</span><span class="p">,</span> <span class="n">pseudo_pids</span><span class="p">)</span>

    <span class="c1"># Only keep entries with a status of &quot;RETURNED&quot; or &quot;AWAITING REVIEW&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;RETURNED&quot;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;AWAITING REVIEW&quot;</span><span class="p">)]</span>

    <span class="c1"># Get all the remaining participant ids and store them in an array</span>
    <span class="n">pids</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Participant id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="n">rejection_reason</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Did not consent&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;Failed attention check&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;Failed comprehension check&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;Failed colorblindness test&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;Something else&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;Actually passed!&quot;</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">pids</span><span class="p">:</span>
        <span class="n">booleans</span> <span class="o">=</span> <span class="n">get_booleans</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">booleans</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rejection_reason</span><span class="p">[</span><span class="s2">&quot;Did not consent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">booleans</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">rejection_reason</span><span class="p">[</span><span class="s2">&quot;Failed colorblindness test&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="n">booleans</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">rejection_reason</span><span class="p">[</span><span class="s2">&quot;Failed comprehension check&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">booleans</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">user_data</span> <span class="o">=</span> <span class="n">process_ratings</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">post_hoc</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">user_data</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rejection_reason</span><span class="p">[</span><span class="s2">&quot;Something else&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Main study data not found for PID:&quot;</span><span class="p">,</span> <span class="n">pid</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">user_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.67</span><span class="p">:</span>
                <span class="n">rejection_reason</span><span class="p">[</span><span class="s2">&quot;Failed attention check&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rejection_reason</span><span class="p">[</span><span class="s2">&quot;Something else&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">pids_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">pseudo_pids</span><span class="p">:</span>
            <span class="n">booleans</span> <span class="o">=</span> <span class="n">get_booleans</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
        
            <span class="k">if</span> <span class="n">booleans</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rejection_reason</span><span class="p">[</span><span class="s2">&quot;Did not consent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">booleans</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">rejection_reason</span><span class="p">[</span><span class="s2">&quot;Failed colorblindness test&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
            
            <span class="k">elif</span> <span class="n">booleans</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">rejection_reason</span><span class="p">[</span><span class="s2">&quot;Failed comprehension check&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">booleans</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">user_data</span> <span class="o">=</span> <span class="n">process_ratings</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">post_hoc</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">user_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.67</span><span class="p">:</span>
                    <span class="n">rejection_reason</span><span class="p">[</span><span class="s2">&quot;Failed attention check&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rejection_reason</span><span class="p">[</span><span class="s2">&quot;Actually passed!&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
                    <span class="c1">#print(&quot;Actually passed:&quot;, pid)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rejection_reason</span><span class="p">[</span><span class="s2">&quot;Something else&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">rejection_reason</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rejection_reason</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">rejection_reason</span>    </div>

<div class="viewcode-block" id="analyze_subsample_run"><a class="viewcode-back" href="../api.html#data_processing.analyze_subsample_run">[docs]</a><span class="k">def</span> <span class="nf">analyze_subsample_run</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    
    <span class="c1"># Get min and max of each column</span>
    <span class="n">min_values</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">max_values</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Min Values&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">min_values</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Max Values&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">max_values</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># Count distinct values for the column &quot;Required Sample Size (Noether)&quot;</span>
    <span class="n">noether_sample_size</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Required Sample Size (Noether)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Noether Sample Size&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">noether_sample_size</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># Count distinct values for the column &quot;Max Sequence Length&quot;</span>
    <span class="n">max_seq_length</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Max Sequence Length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Max Sequence Length&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">max_seq_length</span><span class="p">)</span></div>

<div class="viewcode-block" id="cb_test_mistakes"><a class="viewcode-back" href="../api.html#data_processing.cb_test_mistakes">[docs]</a><span class="k">def</span> <span class="nf">cb_test_mistakes</span><span class="p">(</span><span class="n">pids</span><span class="p">):</span>
    <span class="n">mistakes</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;CB Data was not stored propely&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;User never used the no digit option&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;User just got it wrong&quot;</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">}</span>

    <span class="n">failed_card_ids</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">pids</span><span class="p">:</span>
        <span class="n">cb_data</span> <span class="o">=</span> <span class="n">get_colorblind_answers</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>

        <span class="n">answers</span> <span class="o">=</span> <span class="n">cb_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">correct_digits</span> <span class="o">=</span> <span class="n">cb_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">card_ids</span> <span class="o">=</span> <span class="n">cb_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
    
        <span class="c1"># Case 1: CB were wrongly stored</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">answers</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">mistakes</span><span class="p">[</span><span class="s2">&quot;CB Data was not stored propely&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;I don&#39;t see a digit&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">answers</span><span class="p">:</span>
                <span class="n">mistakes</span><span class="p">[</span><span class="s2">&quot;User never used the no digit option&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
            
            <span class="k">elif</span> <span class="n">answers</span> <span class="o">!=</span> <span class="n">correct_digits</span><span class="p">:</span>
                <span class="n">mistakes</span><span class="p">[</span><span class="s2">&quot;User just got it wrong&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">answers</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">answers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">correct_digits</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">solution</span> <span class="o">=</span> <span class="s2">&quot;You answered with:&quot;</span> <span class="o">+</span> <span class="n">answers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;. The correct digit is: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">correct_digits</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">card_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">failed_card_ids</span><span class="p">:</span>
                            <span class="n">failed_card_ids</span><span class="p">[</span><span class="n">card_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">solution</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">failed_card_ids</span><span class="p">[</span><span class="n">card_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mistakes</span><span class="p">,</span> <span class="n">failed_card_ids</span> </div>

<div class="viewcode-block" id="get_comprehension_check_performance"><a class="viewcode-back" href="../api.html#data_processing.get_comprehension_check_performance">[docs]</a><span class="k">def</span> <span class="nf">get_comprehension_check_performance</span><span class="p">(</span><span class="n">pids</span><span class="p">):</span>
    <span class="n">performance</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;4/6&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;3/6&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;2/6&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;1/6&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;0/6&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">}</span>

    <span class="n">wrong_choices</span> <span class="o">=</span> <span class="p">{</span>

    <span class="p">}</span>

    <span class="n">won_comparison</span> <span class="o">=</span> <span class="p">{</span>

    <span class="p">}</span>

    <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">pids</span><span class="p">:</span>
        <span class="n">performance_data</span> <span class="o">=</span> <span class="n">get_comprehension_check_answers</span><span class="p">(</span><span class="n">pid</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">performance_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="n">performance_data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">performance_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="ow">in</span> <span class="n">wrong_choices</span><span class="p">:</span>
                    <span class="n">wrong_choices</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">performance_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])]</span> <span class="o">+=</span> <span class="mi">1</span>
                
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">performance_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">wrong_choices</span><span class="p">:</span>
                    <span class="n">wrong_choices</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">performance_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])]</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">performance_data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">won_comparison</span><span class="p">:</span>
                    <span class="n">won_comparison</span><span class="p">[</span><span class="n">performance_data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">performance_data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">won_comparison</span><span class="p">:</span>
                    <span class="n">won_comparison</span><span class="p">[</span><span class="n">performance_data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
            
        <span class="k">if</span> <span class="n">correct</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">performance</span><span class="p">[</span><span class="s2">&quot;4/6&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">correct</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">performance</span><span class="p">[</span><span class="s2">&quot;3/6&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">correct</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">performance</span><span class="p">[</span><span class="s2">&quot;2/6&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">correct</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">performance</span><span class="p">[</span><span class="s2">&quot;1/6&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">performance</span><span class="p">[</span><span class="s2">&quot;0/6&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
    
    <span class="c1"># Order wrong_choices and won_comparison based on the number of times a choice was made</span>
    <span class="n">wrong_choices</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">wrong_choices</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">won_comparison</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">won_comparison</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">performance</span><span class="p">,</span> <span class="n">wrong_choices</span><span class="p">,</span> <span class="n">won_comparison</span></div>

<div class="viewcode-block" id="get_time_stats_for_phase"><a class="viewcode-back" href="../api.html#data_processing.get_time_stats_for_phase">[docs]</a><span class="k">def</span> <span class="nf">get_time_stats_for_phase</span><span class="p">(</span><span class="n">pids</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="s1">&#39;comprehension_check&#39;</span><span class="p">):</span>
    <span class="n">phase_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">pids</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">phase</span> <span class="o">==</span> <span class="s1">&#39;comprehension_check&#39;</span><span class="p">:</span>
            <span class="n">phase_time</span> <span class="o">=</span> <span class="n">get_comprehension_check_time</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">phase_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">phase_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phase_time</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User with PID&quot;</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="s2">&quot;was excluded due to missing data&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">phase</span> <span class="o">==</span> <span class="s1">&#39;colorblindness_test&#39;</span><span class="p">:</span>
            <span class="n">phase_time</span> <span class="o">=</span> <span class="n">get_colorblindness_time</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">phase_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">phase_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phase_time</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User with PID&quot;</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="s2">&quot;was excluded due to missing data&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid phase&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="n">avg_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">phase_times</span><span class="p">)</span>
    <span class="n">median_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">phase_times</span><span class="p">)</span>
    <span class="n">min_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">phase_times</span><span class="p">)</span>
    <span class="n">max_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">phase_times</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">phase_times</span><span class="p">,</span> <span class="n">avg_time</span><span class="p">,</span> <span class="n">median_time</span><span class="p">,</span> <span class="n">min_time</span><span class="p">,</span> <span class="n">max_time</span></div>

<div class="viewcode-block" id="get_comprehension_check_time"><a class="viewcode-back" href="../api.html#data_processing.get_comprehension_check_time">[docs]</a><span class="k">def</span> <span class="nf">get_comprehension_check_time</span><span class="p">(</span><span class="n">pid</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">database_connection</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot; WITH time_diff_table as (</span>
<span class="s2">                            SELECT url, time, time - lag(time) over (order by time) as time_diff</span>
<span class="s2">                            FROM site_logs</span>
<span class="s2">                            WHERE pid = </span><span class="si">%s</span>
<span class="s2">                        )</span>
<span class="s2">                        SELECT sum(time_diff)</span>
<span class="s2">                        FROM time_diff_table</span>
<span class="s2">                        WHERE url like &#39;</span><span class="si">%%</span><span class="s2">main-study-instructions</span><span class="si">%%</span><span class="s2">&#39; or url like &#39;</span><span class="si">%%</span><span class="s2">comprehension-check</span><span class="si">%%</span><span class="s2">&#39;</span>
<span class="s2">                    &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">pid</span><span class="p">,))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="get_colorblindness_time"><a class="viewcode-back" href="../api.html#data_processing.get_colorblindness_time">[docs]</a><span class="k">def</span> <span class="nf">get_colorblindness_time</span><span class="p">(</span><span class="n">pid</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">database_connection</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot; WITH time_diff_table as (</span>
<span class="s2">                            SELECT url, time, time - lag(time) over (order by time) as time_diff</span>
<span class="s2">                            FROM site_logs</span>
<span class="s2">                            WHERE pid = </span><span class="si">%s</span>
<span class="s2">                        )</span>
<span class="s2">                        SELECT time_diff</span>
<span class="s2">                        FROM time_diff_table</span>
<span class="s2">                        WHERE url like &#39;</span><span class="si">%%</span><span class="s2">focal-study-instructions</span><span class="si">%%</span><span class="s2">&#39;</span>
<span class="s2">                    &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">pid</span><span class="p">,))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="even_odd_consistency"><a class="viewcode-back" href="../api.html#data_processing.even_odd_consistency">[docs]</a><span class="k">def</span> <span class="nf">even_odd_consistency</span><span class="p">(</span><span class="n">pid</span><span class="p">):</span>
    <span class="n">ratings</span> <span class="o">=</span> <span class="n">get_main_study_ratings</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
    <span class="n">ratings</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rating</span><span class="p">)</span> <span class="k">for</span> <span class="n">rating</span> <span class="ow">in</span> <span class="n">ratings</span><span class="p">]</span>

    <span class="n">even_items</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">odd_items</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">even_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">even_items</span><span class="p">)</span>
    <span class="n">odd_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">odd_items</span><span class="p">)</span>

    <span class="n">correlation</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pearsonr</span><span class="p">(</span><span class="n">even_items</span><span class="p">,</span> <span class="n">odd_items</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">even_score</span><span class="p">,</span> <span class="n">odd_score</span><span class="p">,</span> <span class="n">correlation</span></div>

<div class="viewcode-block" id="resampling_consistency"><a class="viewcode-back" href="../api.html#data_processing.resampling_consistency">[docs]</a><span class="k">def</span> <span class="nf">resampling_consistency</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_resamples</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="n">ratings</span> <span class="o">=</span> <span class="n">get_main_study_ratings</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
    <span class="n">ratings</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rating</span><span class="p">)</span> <span class="k">for</span> <span class="n">rating</span> <span class="ow">in</span> <span class="n">ratings</span><span class="p">]</span>

    <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">ratings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span>

    <span class="n">correlations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_resamples</span><span class="p">):</span>
        <span class="c1"># Randomly split the ratings into two groups</span>
        <span class="n">rng</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span>
        <span class="n">first_half</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">second_half</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:]</span>

        <span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">first_half</span><span class="p">,</span> <span class="n">second_half</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">correlations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">corr</span><span class="p">)</span>

    <span class="c1"># Average the correlations</span>
    <span class="n">median_correlation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">correlations</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">median_correlation</span></div>

<div class="viewcode-block" id="get_sample_feedback"><a class="viewcode-back" href="../api.html#data_processing.get_sample_feedback">[docs]</a><span class="k">def</span> <span class="nf">get_sample_feedback</span><span class="p">(</span><span class="n">pids</span><span class="p">,</span> <span class="n">anonymous</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">database_connection</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT pid, feedback FROM feedback&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">pids</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">anonymous</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<span class="c1"># Effectively provides you with all the info you need for IRV shenanigans</span>
<span class="c1"># E.g., You could use the provided sd range to determine what standard deviation value may be appropriate</span>
<div class="viewcode-block" id="sd_stats"><a class="viewcode-back" href="../api.html#data_processing.sd_stats">[docs]</a><span class="k">def</span> <span class="nf">sd_stats</span><span class="p">(</span><span class="n">pids</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">only_values</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">real_sds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">modified_sds</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">pids</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_sample_averages</span><span class="p">([</span><span class="n">pid</span><span class="p">],</span> <span class="n">only_arrays</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">real_images_sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">modified_images_sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">real_sds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">real_images_sd</span><span class="p">)</span>
        <span class="n">modified_sds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modified_images_sd</span><span class="p">)</span>
    
    <span class="n">real_sds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">real_sds</span><span class="p">)</span>
    <span class="n">modified_sds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">modified_sds</span><span class="p">)</span>

    <span class="n">real_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">real_sds</span><span class="p">)</span>
    <span class="n">real_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">real_sds</span><span class="p">)</span>
    <span class="n">modified_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">modified_sds</span><span class="p">)</span>
    <span class="n">modified_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">modified_sds</span><span class="p">)</span>

    <span class="c1"># Range, where 95% of the data lies</span>
    <span class="n">real_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">real_sds</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">])</span>
    <span class="n">modified_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">modified_sds</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">])</span>

    <span class="c1"># Range, where 80% of the data lies</span>
    <span class="n">real_range_80</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">real_sds</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">90</span><span class="p">])</span>
    <span class="n">modified_range_80</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">modified_sds</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">90</span><span class="p">])</span>

    <span class="c1"># Range, where 85% of the data lies</span>
    <span class="n">real_range_85</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">real_sds</span><span class="p">,</span> <span class="p">[</span><span class="mf">7.5</span><span class="p">,</span> <span class="mf">92.5</span><span class="p">])</span>
    <span class="n">modified_range_85</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">modified_sds</span><span class="p">,</span> <span class="p">[</span><span class="mf">7.5</span><span class="p">,</span> <span class="mf">92.5</span><span class="p">])</span>

    <span class="c1"># Range, where 90% of the data lies</span>
    <span class="n">real_range_90</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">real_sds</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">95</span><span class="p">])</span>
    <span class="n">modified_range_90</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">modified_sds</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">95</span><span class="p">])</span>

    <span class="c1"># Range, where 99% of the data lies</span>
    <span class="n">real_range_99</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">real_sds</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">99.5</span><span class="p">])</span>
    <span class="n">modified_range_99</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">modified_sds</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">99.0</span><span class="p">])</span> <span class="c1"># As minimum is 0</span>

    <span class="k">if</span> <span class="n">only_values</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">real_min</span><span class="p">,</span> <span class="n">real_max</span><span class="p">,</span> <span class="n">modified_min</span><span class="p">,</span> <span class="n">modified_max</span><span class="p">,</span> <span class="n">real_range</span><span class="p">,</span> <span class="n">modified_range</span><span class="p">,</span> <span class="n">real_range_80</span><span class="p">,</span> <span class="n">modified_range_80</span><span class="p">,</span> <span class="n">real_range_85</span><span class="p">,</span> <span class="n">modified_range_85</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Real Images SD Min:&quot;</span><span class="p">,</span> <span class="n">real_min</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Real Images SD Max:&quot;</span><span class="p">,</span> <span class="n">real_max</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Modified Images SD Min:&quot;</span><span class="p">,</span> <span class="n">modified_min</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Modified Images SD Max:&quot;</span><span class="p">,</span> <span class="n">modified_max</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ranges that contain 95</span><span class="si">% o</span><span class="s2">f the data&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Real Images SD Range:&quot;</span><span class="p">,</span> <span class="n">real_range</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Modified Images SD Range:&quot;</span><span class="p">,</span> <span class="n">modified_range</span><span class="p">)</span>

    <span class="c1">#print(&quot;Ranges that contain 80% of the data&quot;)</span>
    <span class="c1">#print(&quot;Real Images SD Range:&quot;, real_range_80)</span>
    <span class="c1">#print(&quot;Modified Images SD Range:&quot;, modified_range_80)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ranges that contain 85</span><span class="si">% o</span><span class="s2">f the data&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Real Images SD Range:&quot;</span><span class="p">,</span> <span class="n">real_range_85</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Modified Images SD Range:&quot;</span><span class="p">,</span> <span class="n">modified_range_85</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ranges that contain 90</span><span class="si">% o</span><span class="s2">f the data&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Real Images SD Range:&quot;</span><span class="p">,</span> <span class="n">real_range_90</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Modified Images SD Range:&quot;</span><span class="p">,</span> <span class="n">modified_range_90</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ranges that contain 99</span><span class="si">% o</span><span class="s2">f the data&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Real Images SD Range:&quot;</span><span class="p">,</span> <span class="n">real_range_99</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Modified Images SD Range:&quot;</span><span class="p">,</span> <span class="n">modified_range_99</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
        <span class="c1"># Draw a histogram of the standard deviations</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">real_sds</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Standard Deviation of Real Images&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Standard Deviation&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">modified_sds</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Standard Deviation of Modified Images&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Standard Deviation&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="performance_versus_time"><a class="viewcode-back" href="../api.html#data_processing.performance_versus_time">[docs]</a><span class="k">def</span> <span class="nf">performance_versus_time</span><span class="p">(</span><span class="n">pids</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">performance_overall</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">performance_real</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">performance_modified</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">pids</span><span class="p">:</span>
        <span class="c1"># user_data = [pid, accuracy, real_accuracy, modified_accuracy, check_accuracy]</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">get_total_time</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>

        <span class="c1"># Check if time is over 1 hour</span>
        <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">3600</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">process_ratings</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">post_hoc</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">performance_overall</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">performance_real</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">performance_modified</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        
    <span class="n">performance_overall</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">performance_overall</span><span class="p">)</span>
    <span class="n">performance_real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">performance_real</span><span class="p">)</span>
    <span class="n">performance_modified</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">performance_modified</span><span class="p">)</span>
    <span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of participants (excluding wrongly tracked times):&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">performance_overall</span><span class="p">))</span>

    <span class="c1"># Define the time sections</span>
    <span class="n">sections</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="p">(</span><span class="mi">1001</span><span class="p">,</span> <span class="mi">1750</span><span class="p">),</span> <span class="p">(</span><span class="mi">1751</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">))]</span>
    <span class="n">section_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0-1000&#39;</span><span class="p">,</span> <span class="s1">&#39;1001-1750&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;1750&#39;</span><span class="p">]</span>

    <span class="c1"># Initialize lists to store means and standard deviations</span>
    <span class="n">overall_means</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">overall_stds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">real_means</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">real_stds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">modified_means</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">modified_stds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">times</span> <span class="o">&gt;=</span> <span class="n">start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">times</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">)</span>
        <span class="n">counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">))</span>
        <span class="n">overall_means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">performance_overall</span><span class="p">[</span><span class="n">mask</span><span class="p">]))</span>
        <span class="n">overall_stds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">performance_overall</span><span class="p">[</span><span class="n">mask</span><span class="p">]))</span>
        <span class="n">real_means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">performance_real</span><span class="p">[</span><span class="n">mask</span><span class="p">]))</span>
        <span class="n">real_stds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">performance_real</span><span class="p">[</span><span class="n">mask</span><span class="p">]))</span>
        <span class="n">modified_means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">performance_modified</span><span class="p">[</span><span class="n">mask</span><span class="p">]))</span>
        <span class="n">modified_stds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">performance_modified</span><span class="p">[</span><span class="n">mask</span><span class="p">]))</span>

    <span class="c1"># Update section labels to include counts</span>
    <span class="n">section_labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="se">\n</span><span class="s1">(n=</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s1">)&#39;</span> <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">section_labels</span><span class="p">,</span> <span class="n">counts</span><span class="p">)]</span>

    <span class="c1"># Plot the performance versus time as bar charts with error bars</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">section_labels</span><span class="p">))</span>  <span class="c1"># the label locations</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mf">0.25</span>  <span class="c1"># the width of the bars</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">rects1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">width</span><span class="p">,</span> <span class="n">overall_means</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">overall_stds</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Overall Performance&#39;</span><span class="p">)</span>
    <span class="n">rects2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">real_means</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">real_stds</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Real Image Performance&#39;</span><span class="p">)</span>
    <span class="n">rects3</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">width</span><span class="p">,</span> <span class="n">modified_means</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">modified_stds</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Modified Image Performance&#39;</span><span class="p">)</span>

    <span class="c1"># Add some text for labels, title and custom x-axis tick labels, etc.</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Total Time (seconds)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Performance&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Performance by Time Sections&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">section_labels</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;performance_vs_time.png&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="process_sd_range"><a class="viewcode-back" href="../api.html#data_processing.process_sd_range">[docs]</a><span class="k">def</span> <span class="nf">process_sd_range</span><span class="p">(</span><span class="n">sd_range</span><span class="p">):</span>
    
    <span class="c1"># Remove the brackets</span>
    <span class="n">sd_range</span> <span class="o">=</span> <span class="n">sd_range</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># Remove outer whitespace</span>
    <span class="n">sd_range</span> <span class="o">=</span> <span class="n">sd_range</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="c1"># Ensure that there is only one whitespace between the two values</span>
    <span class="n">sd_range</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sd_range</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="c1"># Get the two values</span>
    <span class="n">val1</span> <span class="o">=</span> <span class="n">sd_range</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">val1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val1</span><span class="p">)</span>
    <span class="n">val2</span> <span class="o">=</span> <span class="n">sd_range</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">val2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">val2</span> <span class="o">-</span> <span class="n">val1</span></div>

<div class="viewcode-block" id="analyze_sd_subsample_run"><a class="viewcode-back" href="../api.html#data_processing.analyze_sd_subsample_run">[docs]</a><span class="k">def</span> <span class="nf">analyze_sd_subsample_run</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    
    <span class="c1"># Generate two df copies: one with only the first half of the columns and one with the second half</span>
    <span class="n">df_extrems</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">df_ranges</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:]</span>

    <span class="c1"># Get min and max of each column</span>
    <span class="n">min_values</span> <span class="o">=</span> <span class="n">df_extrems</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">max_values</span> <span class="o">=</span> <span class="n">df_extrems</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Min Values&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">min_values</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Max Values&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">max_values</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="n">smallest_real_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">smallest_modified_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">smallest_real_range_80</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">smallest_modified_range_80</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

    <span class="n">largest_real_range</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">largest_modified_range</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">largest_real_range_80</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">largest_modified_range_80</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

    <span class="c1"># Iterate over all rows in df_ranges</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_ranges</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        
        <span class="n">real_range</span> <span class="o">=</span> <span class="n">process_sd_range</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;real_range&quot;</span><span class="p">])</span>
        <span class="n">modified_range</span> <span class="o">=</span> <span class="n">process_sd_range</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;modified_range&quot;</span><span class="p">])</span>
        <span class="n">real_range_80</span> <span class="o">=</span> <span class="n">process_sd_range</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;real_range_80&quot;</span><span class="p">])</span>
        <span class="n">modified_range_80</span> <span class="o">=</span> <span class="n">process_sd_range</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;modified_range_80&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">real_range</span> <span class="o">&lt;</span> <span class="n">smallest_real_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">smallest_real_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">real_range</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;real_range&quot;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">modified_range</span> <span class="o">&lt;</span> <span class="n">smallest_modified_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">smallest_modified_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">modified_range</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;modified_range&quot;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">real_range_80</span> <span class="o">&lt;</span> <span class="n">smallest_real_range_80</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">smallest_real_range_80</span> <span class="o">=</span> <span class="p">[</span><span class="n">real_range_80</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;real_range_80&quot;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">modified_range_80</span> <span class="o">&lt;</span> <span class="n">smallest_modified_range_80</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">smallest_modified_range_80</span> <span class="o">=</span> <span class="p">[</span><span class="n">modified_range_80</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;modified_range_80&quot;</span><span class="p">]]</span>

        <span class="k">if</span> <span class="n">real_range</span> <span class="o">&gt;</span> <span class="n">largest_real_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">largest_real_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">real_range</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;real_range&quot;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">modified_range</span> <span class="o">&gt;</span> <span class="n">largest_modified_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">largest_modified_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">modified_range</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;modified_range&quot;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">real_range_80</span> <span class="o">&gt;</span> <span class="n">largest_real_range_80</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">largest_real_range_80</span> <span class="o">=</span> <span class="p">[</span><span class="n">real_range_80</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;real_range_80&quot;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">modified_range_80</span> <span class="o">&gt;</span> <span class="n">largest_modified_range_80</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">largest_modified_range_80</span> <span class="o">=</span> <span class="p">[</span><span class="n">modified_range_80</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;modified_range_80&quot;</span><span class="p">]]</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Smallest Real Range:&quot;</span><span class="p">,</span> <span class="n">smallest_real_range</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Smallest Modified Range:&quot;</span><span class="p">,</span> <span class="n">smallest_modified_range</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Smallest Real Range 80:&quot;</span><span class="p">,</span> <span class="n">smallest_real_range_80</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Smallest Modified Range 80:&quot;</span><span class="p">,</span> <span class="n">smallest_modified_range_80</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Largest Real Range:&quot;</span><span class="p">,</span> <span class="n">largest_real_range</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Largest Modified Range:&quot;</span><span class="p">,</span> <span class="n">largest_modified_range</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Largest Real Range 80:&quot;</span><span class="p">,</span> <span class="n">largest_real_range_80</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Largest Modified Range 80:&quot;</span><span class="p">,</span> <span class="n">largest_modified_range_80</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="filtered_users_stats"><a class="viewcode-back" href="../api.html#data_processing.filtered_users_stats">[docs]</a><span class="k">def</span> <span class="nf">filtered_users_stats</span><span class="p">(</span><span class="n">pids</span><span class="p">,</span> <span class="n">max_hard_indicators</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_soft_indicators</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">array_only</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">user_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">pids</span><span class="p">:</span>
        <span class="n">ratings</span> <span class="o">=</span> <span class="n">get_main_study_ratings</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
        <span class="n">attention_checks</span> <span class="o">=</span> <span class="n">process_ratings</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">post_hoc</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">average_image_time</span> <span class="o">=</span> <span class="n">get_average_image_time</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
        <span class="n">avg_in_seconds</span> <span class="o">=</span> <span class="n">average_image_time</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">max_seq_length</span><span class="p">,</span> <span class="n">mean_seq_length</span><span class="p">,</span> <span class="n">median_seq_length</span> <span class="o">=</span> <span class="n">long_string</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span>
        <span class="n">real_ratings</span><span class="p">,</span> <span class="n">modified_ratings</span> <span class="o">=</span> <span class="n">get_sample_averages</span><span class="p">([</span><span class="n">pid</span><span class="p">],</span> <span class="n">only_arrays</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">real_sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">real_ratings</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">modified_sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">modified_ratings</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="n">user_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;pid&quot;</span><span class="p">:</span> <span class="n">pid</span><span class="p">,</span>
            <span class="s2">&quot;ratings&quot;</span><span class="p">:</span> <span class="n">ratings</span><span class="p">,</span>
            <span class="s2">&quot;attention_checks&quot;</span><span class="p">:</span> <span class="n">attention_checks</span><span class="p">,</span>
            <span class="s2">&quot;time_per_image&quot;</span><span class="p">:</span> <span class="n">avg_in_seconds</span><span class="p">,</span>
            <span class="s2">&quot;max_seq_length&quot;</span><span class="p">:</span> <span class="n">max_seq_length</span><span class="p">,</span>
            <span class="s2">&quot;mean_seq_length&quot;</span><span class="p">:</span> <span class="n">mean_seq_length</span><span class="p">,</span>
            <span class="s2">&quot;median_seq_length&quot;</span><span class="p">:</span> <span class="n">median_seq_length</span><span class="p">,</span>
            <span class="s2">&quot;real_sd&quot;</span><span class="p">:</span> <span class="n">real_sd</span><span class="p">,</span>
            <span class="s2">&quot;modified_sd&quot;</span><span class="p">:</span> <span class="n">modified_sd</span><span class="p">,</span>
        <span class="p">})</span>
    
    <span class="c1"># Define a set of boolean conditions to filter the users</span>
    <span class="n">instant_out</span> <span class="o">=</span> <span class="p">[</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;attention_checks&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.67</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;time_per_image&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;max_seq_length&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;mean_seq_length&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">2.11</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;median_seq_length&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.5463</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;real_sd&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">1.914</span><span class="p">),</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;modified_sd&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.7328</span>
    <span class="p">]</span>
    
    <span class="n">hard_indicators</span> <span class="o">=</span> <span class="p">[</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;time_per_image&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">2.456</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;max_seq_length&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;mean_seq_length&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.8028</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.5923</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;real_sd&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">1.7505</span><span class="p">),</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;modified_sd&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.643</span>
    <span class="p">]</span>

    <span class="n">soft_indicators</span> <span class="o">=</span> <span class="p">[</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;time_per_image&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">2.756</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;max_seq_length&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">7</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;mean_seq_length&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.7168</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.6818</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;real_sd&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">1.68006</span><span class="p">),</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.106</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;modified_sd&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">1.5517</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1"># Filter out all users who fail at least one instant out condition</span>
    <span class="c1"># Remove affected users from the user_data list</span>
    <span class="n">user_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">user</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">user_data</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">condition</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="n">instant_out</span><span class="p">)]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">array_only</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of users after instant out:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_data</span><span class="p">))</span>

    <span class="c1"># Filter out all users who fail more than max_hard_indicators hard indicators</span>
    <span class="c1"># Remove affected users from the user_data list</span>
    <span class="n">user_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">user</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">user_data</span> <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">condition</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="n">hard_indicators</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_hard_indicators</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">array_only</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of users after hard indicators:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_data</span><span class="p">))</span>

    <span class="c1"># Filter out all users who fail more than max_soft_indicators soft indicators</span>
    <span class="c1"># Remove affected users from the user_data list</span>
    <span class="n">user_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">user</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">user_data</span> <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">condition</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="n">soft_indicators</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_soft_indicators</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">array_only</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of users after soft indicators:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_data</span><span class="p">))</span>
        <span class="n">population_overview</span><span class="p">([</span><span class="n">user</span><span class="p">[</span><span class="s2">&quot;pid&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">user_data</span><span class="p">])</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">user</span><span class="p">[</span><span class="s2">&quot;pid&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">user_data</span><span class="p">]</span></div>

<div class="viewcode-block" id="threshold_subsampling_overview"><a class="viewcode-back" href="../api.html#data_processing.threshold_subsampling_overview">[docs]</a><span class="k">def</span> <span class="nf">threshold_subsampling_overview</span><span class="p">(</span><span class="n">pids</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="n">header</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;Max_Hard_Indicators&quot;</span><span class="p">,</span> <span class="s2">&quot;Max_Soft_Indicators&quot;</span><span class="p">,</span> <span class="s2">&quot;Number of Participants&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Real Images Mean&quot;</span><span class="p">,</span> <span class="s2">&quot;Real Images SD&quot;</span><span class="p">,</span> <span class="s2">&quot;Modified Images Mean&quot;</span><span class="p">,</span> <span class="s2">&quot;Modified Images SD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;P(X &gt; Y)&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;P-Value&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;Effect Size (PCC)&quot;</span><span class="p">,</span> <span class="s2">&quot;Effect Size (A.R.E)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Required Sample Size (Noether)&quot;</span><span class="p">,</span> <span class="s2">&quot;Required Sample Size (A.R.E.)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Total Time Mean&quot;</span><span class="p">,</span> <span class="s2">&quot;Total Time Median&quot;</span><span class="p">,</span> <span class="s2">&quot;Total Time Min&quot;</span><span class="p">,</span> <span class="s2">&quot;Total Time Max&quot;</span><span class="p">,</span> <span class="s2">&quot;Total Time SD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Average Image Time Mean&quot;</span><span class="p">,</span> <span class="s2">&quot;Average Image Time Median&quot;</span><span class="p">,</span> <span class="s2">&quot;Average Image Time Min&quot;</span><span class="p">,</span> <span class="s2">&quot;Average Image Time Max&quot;</span><span class="p">,</span> <span class="s2">&quot;Average Image Time SD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Max Sequence Length&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean Sequence Length&quot;</span><span class="p">,</span> <span class="s2">&quot;Median Sequence Length&quot;</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

    <span class="n">now</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">now</span><span class="si">}</span><span class="s2">_threshold_subsampling_overview.csv&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">max_hard_indicators</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">max_soft_indicators</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)):</span>
            <span class="n">entries</span> <span class="o">=</span> <span class="n">filtered_users_stats</span><span class="p">(</span><span class="n">pids</span><span class="p">,</span> <span class="n">max_hard_indicators</span><span class="o">=</span><span class="n">max_hard_indicators</span><span class="p">,</span> <span class="n">max_soft_indicators</span><span class="o">=</span><span class="n">max_soft_indicators</span><span class="p">,</span> <span class="n">array_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">max_hard_indicators</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">max_soft_indicators</span><span class="si">}</span><span class="s2">,0,,,,,,,,,,,,,,,,,,,,,,,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_sample_averages</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">only_arrays</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="n">real_images_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">real_images_sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                <span class="n">modified_images_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">modified_images_sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                <span class="n">U1</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                <span class="n">p_x_greater_y</span> <span class="o">=</span> <span class="n">U1</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
                <span class="n">U2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">U1</span>
                <span class="n">U</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">U1</span><span class="p">,</span> <span class="n">U2</span><span class="p">)</span>
                <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">U</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span>
                <span class="n">effect_size</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
                <span class="n">effect_size_are</span> <span class="o">=</span> <span class="n">are_method</span><span class="p">(</span><span class="n">real_images_mean</span><span class="p">,</span> <span class="n">modified_images_mean</span><span class="p">,</span> <span class="n">real_images_sd</span><span class="p">,</span> <span class="n">modified_images_sd</span><span class="p">)</span>

                <span class="n">result</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">noether</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p_x_greater_y</span><span class="p">)</span>

                <span class="n">sample_size_are</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">max_seq_length</span><span class="p">,</span> <span class="n">mean_seq_length</span><span class="p">,</span> <span class="n">median_seq_length</span> <span class="o">=</span> <span class="n">accumulate_ls_stats</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>

                <span class="n">total_time_mean</span><span class="p">,</span> <span class="n">total_time_median</span><span class="p">,</span> <span class="n">total_time_min</span><span class="p">,</span> <span class="n">total_time_max</span><span class="p">,</span> <span class="n">total_time_sd</span><span class="p">,</span> <span class="n">average_image_time_mean</span><span class="p">,</span> <span class="n">average_image_time_median</span><span class="p">,</span> <span class="n">average_image_time_min</span><span class="p">,</span> <span class="n">average_image_time_max</span><span class="p">,</span> <span class="n">average_image_time_sd</span> <span class="o">=</span> <span class="n">get_time_stats</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>

                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">max_hard_indicators</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">max_soft_indicators</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">real_images_mean</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">real_images_sd</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">modified_images_mean</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">modified_images_sd</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">p_x_greater_y</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">U</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">effect_size</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">effect_size_are</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">sample_size_are</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">total_time_mean</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">total_time_median</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">total_time_min</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">total_time_max</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">total_time_sd</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">average_image_time_mean</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">average_image_time_median</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">average_image_time_min</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">average_image_time_max</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">average_image_time_sd</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">max_seq_length</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">mean_seq_length</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">median_seq_length</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>
    
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    
    <span class="n">pids_dir</span> <span class="o">=</span> <span class="s2">&quot;/home/dren.fazlija/data/Scooter/pids/&quot;</span>
    <span class="n">attack</span> <span class="o">=</span> <span class="s2">&quot;cadv/&quot;</span>

    <span class="n">pids_file</span> <span class="o">=</span> <span class="n">pids_dir</span> <span class="o">+</span> <span class="n">attack</span> <span class="o">+</span> <span class="s2">&quot;pids.txt&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pids_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">pids</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">pids</span> <span class="o">=</span> <span class="p">[</span><span class="n">pid</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">pids</span><span class="p">]</span>

    <span class="c1"># Comprehension Check Time Stats</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of tracked participants: &quot;</span>  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pids</span><span class="p">)))</span>
    <span class="n">cc_times</span> <span class="o">=</span> <span class="n">get_time_stats_for_phase</span><span class="p">(</span><span class="n">pids</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="s1">&#39;comprehension_check&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Comprehension Check Times&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average Time:&quot;</span><span class="p">,</span> <span class="n">cc_times</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Median Time:&quot;</span><span class="p">,</span> <span class="n">cc_times</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Min Time:&quot;</span><span class="p">,</span> <span class="n">cc_times</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Max Time:&quot;</span><span class="p">,</span> <span class="n">cc_times</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>

    <span class="n">performances</span><span class="p">,</span> <span class="n">wrong_choices</span><span class="p">,</span> <span class="n">won_comparisons</span> <span class="o">=</span> <span class="n">get_comprehension_check_performance</span><span class="p">(</span><span class="n">pids</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">performances</span><span class="p">[</span><span class="s2">&quot;4/6&quot;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">performances</span><span class="p">[</span><span class="s2">&quot;3/6&quot;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">performances</span><span class="p">[</span><span class="s2">&quot;2/6&quot;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">performances</span><span class="p">[</span><span class="s2">&quot;1/6&quot;</span><span class="p">])</span>

    <span class="c1">#non_4_6_pids = [pid for pid in pids if pid not in performances[&quot;4/6&quot;]]</span>

<span class="w">    </span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    semantic_adv_pids_file = &quot;/home/dren.fazlija/data/Scooter/pids/larger_test_study/pids.txt&quot;</span>
<span class="sd">    with open(semantic_adv_pids_file, &quot;r&quot;) as file:</span>
<span class="sd">        semantic_adv_pids = file.readlines()</span>
<span class="sd">        semantic_adv_pids = [pid.strip() for pid in semantic_adv_pids]</span>

<span class="sd">    # Get the pids that failed the comprehension check</span>
<span class="sd">    rejections = get_returned_tasks(pids_dir + attack + &quot;prolific_export.csv&quot;, pids_array=semantic_adv_pids, verbose=True)</span>

<span class="sd">    # Add additional passed pids, if you somehow missed them</span>
<span class="sd">    semantic_adv_pids.extend(rejections[&quot;Actually passed!&quot;])</span>

<span class="sd">    passed_pids = semantic_adv_pids.copy()</span>

<span class="sd">    # Extend with the pids that failed the comprehension check</span>
<span class="sd">    semantic_adv_pids.extend(rejections[&quot;Failed comprehension check&quot;])</span>

<span class="sd">    print(&quot;&quot;)</span>
<span class="sd">    print(&quot;Number of tracked participants: &quot;  + str(len(semantic_adv_pids)))</span>
<span class="sd">          </span>
<span class="sd">    performances, wrong_choices, won_comparisons = get_comprehension_check_performance(semantic_adv_pids)</span>

<span class="sd">    filtered_out = []</span>
<span class="sd">    for key in wrong_choices.keys():</span>
<span class="sd">        if wrong_choices[key] &gt; 2:</span>
<span class="sd">            filtered_out.append(key)</span>
<span class="sd">    for key in won_comparisons.keys():</span>
<span class="sd">        if won_comparisons[key] &gt; 1:</span>
<span class="sd">            filtered_out.append(key)</span>

<span class="sd">    print(&quot;Filtered out:&quot;, len(filtered_out))</span>
<span class="sd">    print(&quot;Passed:&quot;, len(passed_pids))</span>

<span class="sd">    to_be_removed = []</span>

<span class="sd">    for pid in passed_pids:</span>
<span class="sd">        cc_images = get_comprehension_check_answers(pid)[0][1]</span>
<span class="sd">        for i in range(len(cc_images)):</span>
<span class="sd">            if cc_images[i] in filtered_out:</span>
<span class="sd">                to_be_removed.append(pid)</span>
<span class="sd">                break</span>

<span class="sd">    print(&quot;Passed after filtering:&quot;, len(passed_pids) - len(to_be_removed))</span>
<span class="sd">    #population_overview(passed_pids)&quot;&quot;&quot;</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    df = pd.read_csv(pids_dir + attack + &quot;prolific_export.csv&quot;)</span>
<span class="sd">    status_counts = df[&#39;Status&#39;].value_counts()</span>
<span class="sd">    print(status_counts)</span>

<span class="sd">    rejections = get_returned_tasks(pids_dir + attack + &quot;prolific_export.csv&quot;, pids_array=pids, verbose=True)</span>

<span class="sd">    # Add additional passed pids, if you somehow missed them</span>
<span class="sd">    pids.extend(rejections[&quot;Actually passed!&quot;])</span>
<span class="sd">    </span>
<span class="sd">    print(&quot;&quot;)</span>

<span class="sd">    # Comprehension Check Time Stats</span>
<span class="sd">    print(&quot;Number of tracked participants: &quot;  + str(len(pids)))</span>
<span class="sd">    cc_times = get_time_stats_for_phase(pids, phase=&#39;comprehension_check&#39;)</span>
<span class="sd">    print(&quot;Comprehension Check Times&quot;)</span>
<span class="sd">    print(&quot;Average Time:&quot;, cc_times[1])</span>
<span class="sd">    print(&quot;Median Time:&quot;, cc_times[2])</span>
<span class="sd">    print(&quot;Min Time:&quot;, cc_times[3])</span>
<span class="sd">    print(&quot;Max Time:&quot;, cc_times[4])</span>

<span class="sd">    print(&quot;&quot;)</span>
<span class="sd">    print(&quot;&quot;)</span>

<span class="sd">    # Colorblindness Test Time Stats</span>
<span class="sd">    pids.extend(rejections[&quot;Failed comprehension check&quot;])</span>
<span class="sd">    print(&quot;Number of tracked participants: &quot;  + str(len(pids)))</span>
<span class="sd">    cb_times = get_time_stats_for_phase(pids, phase=&#39;colorblindness_test&#39;)</span>
<span class="sd">    print(&quot;Colorblindness Test Times&quot;)</span>
<span class="sd">    print(&quot;Average Time:&quot;, cb_times[1])</span>
<span class="sd">    print(&quot;Median Time:&quot;, cb_times[2])</span>
<span class="sd">    print(&quot;Min Time:&quot;, cb_times[3])</span>
<span class="sd">    print(&quot;Max Time:&quot;, cb_times[4])&quot;&quot;&quot;</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    dir = &quot;/home/dren.fazlija/data/Scooter/pids/cadv/&quot;</span>
<span class="sd">    export_dir = &quot;/home/dren.fazlija/data/Scooter/exported_data/larger_test_study/&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pids_file</span> <span class="o">=</span> <span class="nb">dir</span> <span class="o">+</span> <span class="s2">&quot;ncf_approved.txt&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pids_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">pids</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">pids</span> <span class="o">=</span> <span class="p">[</span><span class="n">pid</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">pids</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    df = pd.read_csv(dir + &quot;prolific_export.csv&quot;)</span>
<span class="sd">    </span>
<span class="sd">    # Only keep entries with a status of &quot;RETURNED&quot; or &quot;AWAITING REVIEW&quot;</span>
<span class="sd">    df = df[(df[&quot;Status&quot;] == &quot;APPROVED&quot;)]</span>

<span class="sd">    # Get all the remaining participant ids and store them in an array</span>
<span class="sd">    pids = df[&quot;Participant id&quot;].values</span>
<span class="sd">    #print(&quot;Original number of participants:&quot;, len(pids))</span>
<span class="sd">    #population_overview(pids)</span>

<span class="sd">    #study_overview(pids, sample_size=60, number_of_sets=10000, seed=0, path=dir, verbose=False, checkpoint=760, early_stop=1000, previous_file=&quot;1722858305169_overview.csv&quot;)</span>

<span class="sd">    #get_sample_feedback(pids, anonymous=True)</span>
<span class="sd">    #get_time_stats(pids, verbose=True)</span>
<span class="sd">    #accumulate_ls_stats(pids, visualize=True)</span>
<span class="sd">    #performance_versus_time(pids, save=True)</span>

<span class="sd">    performances, wrong_choices, won_comparisons = get_comprehension_check_performance(pids)</span>

<span class="sd">    print(performances[&quot;4/6&quot;])</span>
<span class="sd">    print(performances[&quot;3/6&quot;])</span>
<span class="sd">    print(performances[&quot;2/6&quot;])</span>
<span class="sd">    print(performances[&quot;1/6&quot;])</span>

<span class="sd">    non_4_6_pids = [pid for pid in pids if pid not in performances[&quot;4/6&quot;]]</span>
<span class="sd">    print(&quot;Number of participants that got 5/6 or more:&quot;, len(non_4_6_pids))&quot;&quot;&quot;</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    # Get SemanticAdv and NCF pids</span>
<span class="sd">    semantic_adv_pids = []</span>
<span class="sd">    ncf_pids = []</span>

<span class="sd">    semantic_adv_pids_file = &quot;/home/dren.fazlija/data/Scooter/pids/larger_test_study/pids.txt&quot;</span>
<span class="sd">    with open(semantic_adv_pids_file, &quot;r&quot;) as file:</span>
<span class="sd">        semantic_adv_pids = file.readlines()</span>
<span class="sd">        semantic_adv_pids = [pid.strip() for pid in semantic_adv_pids]</span>

<span class="sd">    ncf_pids_file = &quot;/home/dren.fazlija/data/Scooter/pids/ncf/ncf_approved.txt&quot;</span>
<span class="sd">    with open(ncf_pids_file, &quot;r&quot;) as file:</span>
<span class="sd">        ncf_pids = file.readlines()</span>
<span class="sd">        ncf_pids = [pid.strip() for pid in ncf_pids]</span>
<span class="sd">    </span>
<span class="sd">    print(&quot;SemanticAdv Pids:&quot;, len(semantic_adv_pids))</span>
<span class="sd">    print(&quot;NCF Pids:&quot;, len(ncf_pids))</span>
<span class="sd">    print(&quot;cAdv Pids:&quot;, len(non_4_6_pids))</span>

<span class="sd">    combined_pids = list(set(semantic_adv_pids + ncf_pids + non_4_6_pids))</span>
<span class="sd">    print(&quot;Combined Pids:&quot;, len(combined_pids))&quot;&quot;&quot;</span>


    <span class="c1">#population_overview(combined_pids)</span>
    <span class="c1">#get_time_stats(combined_pids, percentiles=True)</span>
    <span class="c1">#performance_versus_time(combined_pids, save=True)</span>
    <span class="c1">#accumulate_ls_stats(combined_pids, visualize=True, previous_means={&quot;SemanticAdv&quot;: 1.437, &quot;NCF&quot;: 1.482, &quot;cAdv&quot;: 1.472})</span>
    <span class="c1">#sd_stats(combined_pids)</span>
    <span class="c1">#ls_percentiles(combined_pids)</span>
    <span class="c1">#filtered_users_stats(combined_pids)</span>
    <span class="c1">#threshold_subsampling_overview(combined_pids, path=&quot;/home/dren.fazlija/data/Scooter/&quot;)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;print(&quot;cAdv stats&quot;)</span>
<span class="sd">    print(accumulate_ls_stats(non_4_6_pids))</span>
<span class="sd">    print(&quot;&quot;)</span>

<span class="sd">    print(&quot;SemanticAdv stats&quot;)</span>
<span class="sd">    print(accumulate_ls_stats(semantic_adv_pids))</span>
<span class="sd">    print(&quot;&quot;)</span>

<span class="sd">    print(&quot;NCF stats&quot;)</span>
<span class="sd">    print(accumulate_ls_stats(ncf_pids))&quot;&quot;&quot;</span>
<span class="w">    </span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    rejections = get_returned_tasks(dir + &quot;prolific_export_66dea778dc3d3c08e9f27063.csv&quot;)</span>
<span class="sd">    print(len(rejections[&quot;Failed comprehension check&quot;]))</span>

<span class="sd">    pids.extend(rejections[&quot;Failed comprehension check&quot;])</span>
<span class="sd">    print(len(pids))</span>

<span class="sd">    cb_times = get_time_stats_for_phase(pids, phase=&#39;colorblindness_test&#39;)</span>
<span class="sd">    cc_times = get_time_stats_for_phase(pids, phase=&#39;comprehension_check&#39;)</span>

<span class="sd">    print(&quot;Colorblindness Test Times&quot;)</span>
<span class="sd">    print(&quot;Average Time:&quot;, cb_times[1])</span>
<span class="sd">    print(&quot;Median Time:&quot;, cb_times[2])</span>
<span class="sd">    print(&quot;Min Time:&quot;, cb_times[3])</span>
<span class="sd">    print(&quot;Max Time:&quot;, cb_times[4])</span>

<span class="sd">    print(&quot;Comprehension Check Times&quot;)</span>
<span class="sd">    print(&quot;Average Time:&quot;, cc_times[1])</span>
<span class="sd">    print(&quot;Median Time:&quot;, cc_times[2])</span>
<span class="sd">    print(&quot;Min Time:&quot;, cc_times[3])</span>
<span class="sd">    print(&quot;Max Time:&quot;, cc_times[4])&quot;&quot;&quot;</span>

    <span class="c1">#get_time_stats(pids, verbose=True)</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    performances, wrong_choices, won_comparisons = get_comprehension_check_performance(pids)</span>

<span class="sd">    print(performances[&quot;4/6&quot;])</span>
<span class="sd">    print(performances[&quot;3/6&quot;])</span>
<span class="sd">    print(performances[&quot;2/6&quot;])</span>
<span class="sd">    print(performances[&quot;1/6&quot;])&quot;&quot;&quot;</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    print(wrong_choices)</span>
<span class="sd">    to_be_deleted_wrong_choices = &quot;&quot;</span>
<span class="sd">    wrong_choices_keys = list(wrong_choices.keys())</span>
<span class="sd">    for key in wrong_choices_keys:</span>
<span class="sd">        if wrong_choices[key] &gt; 2:</span>
<span class="sd">            to_be_deleted_wrong_choices += str(key) + &quot;, &quot;</span>

<span class="sd">    print(to_be_deleted_wrong_choices[:-2])</span>
<span class="sd">    </span>
<span class="sd">    print(won_comparisons)</span>
<span class="sd">    to_be_deleted_won_comparisons = &quot;&quot;</span>
<span class="sd">    won_comparisons_keys = list(won_comparisons.keys())</span>
<span class="sd">    for key in won_comparisons_keys:</span>
<span class="sd">        if won_comparisons[key] &gt; 1:</span>
<span class="sd">            to_be_deleted_won_comparisons += str(key) + &quot;, &quot;</span>
<span class="sd">    print(to_be_deleted_won_comparisons[:-2])&quot;&quot;&quot;</span>
    
    <span class="c1">#get_comprehension_check_image(49)</span>
    <span class="c1">#get_comprehension_check_image(107)</span>
    <span class="c1">#get_comprehension_check_image(37)</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;subsamples = subsampling(pids, 60, 1000, 0)</span>
<span class="sd">    header = [</span>
<span class="sd">        &quot;real_min&quot;, &quot;real_max&quot;, &quot;modified_min&quot;, &quot;modified_max&quot;, &quot;real_range&quot;, &quot;modified_range&quot;, &quot;real_range_80&quot;, &quot;modified_range_80&quot;</span>
<span class="sd">    ]</span>

<span class="sd">    now = int(round(time.time() * 1000))</span>
<span class="sd">    filename = f&quot;{export_dir}/{now}_overview.csv&quot;</span>

<span class="sd">    with open(filename, &#39;w&#39;) as file:</span>
<span class="sd">        file.write(&quot;,&quot;.join(header) + &quot;\n&quot;)</span>

<span class="sd">        for subsample in tqdm(subsamples):</span>
<span class="sd">            entries = list(subsample)</span>
<span class="sd">            real_min, real_max, modified_min, modified_max, real_range, modified_range, real_range_80, modified_range_80 = sd_stats(entries, only_values=True)</span>
<span class="sd">            file.write(f&quot;{real_min},{real_max},{modified_min},{modified_max},{real_range},{modified_range},{real_range_80},{modified_range_80}\n&quot;)&quot;&quot;&quot;</span>

    <span class="c1">#sd_stats(pids, visualize=False)</span>
    <span class="c1">#analyze_sd_subsample_run(export_dir + &quot;1723562184225_overview.csv&quot;)</span>




</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Dren Fazlija.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>